import{w as le,j as e,aA as de,aB as D,aC as ue,aD as he,aE as xe,r as y,at as pe,E as fe,aF as ge,M as me,S as v,z as m,I as ve,ah as je,R as w,C as q,x as K,B as J,a5 as Q,af as I,aG as be,aH as ye,ag as Ce,P as B,as as we,aI as Se}from"./index-I3XiM4Qn.js";import{r as Pe,u as k,w as Ne}from"./xlsx-DSqvgYLF.js";import{p as Qe}from"./aikenParser-D2gryyxM.js";import{U as F}from"./Upload-ZpAtT8-_.js";import{D as O}from"./Download-CMJrisjX.js";import{A as L,a as G,b as H}from"./AccordionSummary-DO3WS7vY.js";const V=le(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}));var Me=class extends de{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:D()})}getOptimisticResult(s){return s.behavior=D(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){const{state:n}=s,f=super.createResult(s,t),{isFetching:g,isRefetching:d,isError:u,isRefetchError:o}=f,x=n.fetchMeta?.fetchMore?.direction,r=u&&x==="forward",i=g&&x==="forward",h=u&&x==="backward",b=g&&x==="backward";return{...f,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:he(t,n.data),hasPreviousPage:ue(t,n.data),isFetchNextPageError:r,isFetchingNextPage:i,isFetchPreviousPageError:h,isFetchingPreviousPage:b,isRefetchError:o&&!r&&!h,isRefetching:d&&!i&&!b}}};function ke(s,t){return xe(s,Me)}const Re={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function Ae({onSubmit:s}){const[t,n]=y.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[f,g]=y.useState(!1),d=(r,i)=>{if(!t||!t.options)return;const h=[...t.options];h[r]={...h[r],text:i},n({...t,options:h})},u=r=>{if(!t||!t.options)return;const i=t?.options.map((h,b)=>({...h,isCorrect:b===r}));n({...t,options:i})},o=r=>{if(!t||!t.options)return;const i=[...t.options];i[r].isCorrect=!i[r].isCorrect,n({...t,options:i})},x=async()=>{try{g(!0),await s([t]),n({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(r){console.error(r)}finally{g(!1)}};return e.jsxs(v,{className:"space-y-4",children:[e.jsx(Q,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:r=>n({...t,question:r.target.value})}),e.jsx(Q,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:r=>n({...t,topic:r.target.value})}),e.jsx(Q,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:r=>n({...t,marks:parseFloat(r.target.value)})}),e.jsx(Q,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:r=>n({...t,negative:parseFloat(r.target.value)})}),e.jsxs(Q,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:r=>{const i=r.target.value,h=Array(4).fill({text:"",isCorrect:!1});n({...t,category:i,options:h,answer:""})},children:[e.jsx(I,{value:"MCQ",children:"MCQ"}),e.jsx(I,{value:"MSQ",children:"MSQ"}),e.jsx(I,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(Q,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:r=>n({...t,answer:r.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&e.jsxs(v,{children:[e.jsx(m,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options&&t.options.map((r,i)=>e.jsxs(v,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(be,{size:"small",checked:r.isCorrect,onChange:()=>u(i)}):e.jsx(ye,{size:"small",checked:r.isCorrect,onChange:()=>o(i)}),e.jsx(Q,{size:"small",fullWidth:!0,label:`Option ${i+1}`,value:r.text,onChange:h=>d(i,h.target.value)})]},i))]}),e.jsx(w,{variant:"contained",onClick:x,disabled:f,children:f?"Submitting...":"Add Question"})]})}function Ee({open:s,onClose:t,onSuccess:n,bankId:f}){const[g,d]=y.useState(null),[u,o]=y.useState([]),x=pe(),{enqueueSnackbar:r}=fe(),{mutateAsync:i,isPending:h}=ge({mutationFn:async a=>{await K.post(`${J}/api/admin/add/questionbanks/questions/${f}/`,a,{withCredentials:!0})},onSuccess:()=>{r("Questions added successfully!",{variant:"success"}),x.invalidateQueries({queryKey:["questionBank",f]}),t(),n()},onError:a=>{r(a?.response?.data?.message||"Failed to add questions",{variant:"error"})}}),b=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),j=JSON.parse(c);o(j)}catch{d("Invalid JSON format")}},S=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.arrayBuffer(),j=Pe(c,{type:"array"}),A=j.Sheets[j.SheetNames[0]],Y=k.sheet_to_json(A).map(X=>{const{question:Z,category:ee,marks:te,negative:se,topic:re,answer:ae,option1:ne,correct1:T,option2:oe,correct2:U,option3:ie,correct3:W,option4:ce,correct4:_}=X,E={question:Z||"",category:ee||"MCQ",marks:parseFloat(te)||1,negative:parseFloat(se)||0,topic:re||""};return E.category==="Text"?{...E,answer:ae||"",options:[]}:{...E,options:[{text:ne||"",isCorrect:T===!0||T==="true"},{text:oe||"",isCorrect:U===!0||U==="true"},{text:ie||"",isCorrect:W===!0||W==="true"},{text:ce||"",isCorrect:_===!0||_==="true"}]}});o(Y)}catch{d("Invalid Excel format")}},p=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),j=Qe(c);if(j.length===0){d("No valid AIKEN questions found");return}d(null),o(j)}catch(c){console.error(c),d("Invalid AIKEN format")}},P=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",options:[{text:"Berlin",isCorrect:!1},{text:"Madrid",isCorrect:!1},{text:"Paris",isCorrect:!0},{text:"Rome",isCorrect:!1}]}],l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.json",c.click()},C=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",option1:"Berlin",correct1:!1,option2:"Madrid",correct2:!1,option3:"Paris",correct3:!0,option4:"Rome",correct4:!1}],l=k.json_to_sheet(a),c=k.book_new();k.book_append_sheet(c,l,"Sample"),Ne(c,"sample_questions.xlsx")},N=()=>{const a=`What is the capital of France?
                    A. Berlin
                    B. Madrid
                    C. Paris
                    D. Rome
                    ANSWER: C`,l=new Blob([a],{type:"text/plain"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.txt",c.click()},M=async a=>{await i(a)};return e.jsx(me,{open:s,onClose:t,children:e.jsxs(v,{sx:{...Re,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(m,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsx(ve,{onClick:t,children:e.jsx(je,{})})]}),e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap",children:[e.jsxs(w,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:b})]}),e.jsx(w,{startIcon:e.jsx(O,{}),onClick:P,children:"Download Sample"}),e.jsxs(w,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:S})]}),e.jsx(w,{startIcon:e.jsx(O,{}),onClick:C,children:"Download Sample"}),e.jsxs(w,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload AIKEN (.txt)",e.jsx("input",{type:"file",accept:".txt",hidden:!0,onChange:p})]}),e.jsx(w,{startIcon:e.jsx(O,{}),onClick:N,children:"Download Sample"})]}),g&&e.jsx(m,{color:"error",variant:"body2",className:"mb-2",children:g}),e.jsx(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(Ae,{onSubmit:M}),u.length>0&&e.jsxs(v,{className:"mt-6",children:[e.jsxs(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:["Preview Uploaded Questions (",u.length,")"]}),u.map((a,l)=>e.jsxs(L,{defaultExpanded:l===0,children:[e.jsx(G,{expandIcon:e.jsx(V,{}),children:e.jsxs(m,{children:["Q",l+1,": ",a.question.slice(0,80),"..."]})}),e.jsxs(H,{children:[e.jsxs(m,{children:[e.jsx("strong",{children:"Topic:"})," ",a.topic]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Marks:"})," ",a.marks]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Negative:"})," ",a.negative]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),(a.category==="MCQ"||a.category==="MSQ")&&e.jsx(v,{className:"mt-2 space-y-1",children:a.options?.map((c,j)=>e.jsxs(m,{children:[c.isCorrect?"✅":"⬜️"," Option ",j+1,": ",c.text]},j))})]})]},l)),e.jsx(w,{className:"mt-4",variant:"contained",disabled:h,onClick:()=>M(u),children:h?"Submitting...":"Submit All Previewed Questions"})]}),h&&e.jsx(q,{className:"mt-4"})]})})}var z=new Map,R=new WeakMap,$=0,Ie;function Be(s){return s?(R.has(s)||($+=1,R.set(s,$.toString())),R.get(s)):"0"}function Fe(s){return Object.keys(s).sort().filter(t=>s[t]!==void 0).map(t=>`${t}_${t==="root"?Be(s.root):s[t]}`).toString()}function Oe(s){const t=Fe(s);let n=z.get(t);if(!n){const f=new Map;let g;const d=new IntersectionObserver(u=>{u.forEach(o=>{var x;const r=o.isIntersecting&&g.some(i=>o.intersectionRatio>=i);s.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=r),(x=f.get(o.target))==null||x.forEach(i=>{i(r,o)})})},s);g=d.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),n={id:t,observer:d,elements:f},z.set(t,n)}return n}function qe(s,t,n={},f=Ie){if(typeof window.IntersectionObserver>"u"&&f!==void 0){const x=s.getBoundingClientRect();return t(f,{isIntersecting:f,target:s,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:x,intersectionRect:x,rootBounds:x}),()=>{}}const{id:g,observer:d,elements:u}=Oe(n),o=u.get(s)||[];return u.has(s)||u.set(s,o),o.push(t),d.observe(s),function(){o.splice(o.indexOf(t),1),o.length===0&&(u.delete(s),d.unobserve(s)),u.size===0&&(d.disconnect(),z.delete(g))}}function ze({threshold:s,delay:t,trackVisibility:n,rootMargin:f,root:g,triggerOnce:d,skip:u,initialInView:o,fallbackInView:x,onChange:r}={}){var i;const[h,b]=y.useState(null),S=y.useRef(r),p=y.useRef(o),[P,C]=y.useState({inView:!!o,entry:void 0});S.current=r,y.useEffect(()=>{if(p.current===void 0&&(p.current=o),u||!h)return;let l;return l=qe(h,(c,j)=>{const A=p.current;p.current=c,!(A===void 0&&!c)&&(C({inView:c,entry:j}),S.current&&S.current(c,j),j.isIntersecting&&d&&l&&(l(),l=void 0))},{root:g,rootMargin:f,threshold:s,trackVisibility:n,delay:t},x),()=>{l&&l()}},[Array.isArray(s)?s.toString():s,h,g,f,d,u,n,x,t]);const N=(i=P.entry)==null?void 0:i.target,M=y.useRef(void 0);!h&&N&&!d&&!u&&M.current!==N&&(M.current=N,C({inView:!!o,entry:void 0}),p.current=o);const a=[b,P.inView,P.entry];return a.ref=a[0],a.inView=a[1],a.entry=a[2],a}function Le(){const{slug:s}=Ce(),[t,n]=y.useState(!1),{ref:f,inView:g}=ze(),{data:d,fetchNextPage:u,hasNextPage:o,isFetchingNextPage:x,isLoading:r,isError:i,refetch:h}=ke({queryKey:["questionBank",s],queryFn:async({pageParam:p})=>(await K.get(`${J}/api/admin/get/questionbank/questions/${s}?page=${p}&limit=10`,{withCredentials:!0})).data,initialPageParam:1,getNextPageParam:p=>p.hasMore?p.page+1:void 0,enabled:!!s}),b=d?.pages?.[0]?.bankDetails,S=d?d.pages.flatMap(p=>p.questions):[];return g&&o&&!x&&u(),e.jsxs(v,{mx:"auto",px:2,py:4,children:[e.jsxs(B,{elevation:3,sx:{p:4,borderRadius:3,mb:5,display:"flex",flexDirection:"column",gap:2},children:[t&&e.jsx(Ee,{open:!0,onSuccess:()=>{n(!1),h()},onClose:()=>n(!1),bankId:s||""}),e.jsx(m,{variant:"h5",fontWeight:"bold",children:b?.name||"Question Bank"}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Category: ",b?.category||"N/A"]}),e.jsx(we,{direction:"row",spacing:2,mt:1,children:e.jsx(w,{variant:"contained",color:"primary",onClick:()=>n(!0),sx:{textTransform:"none",borderRadius:2},children:"Add Question"})})]}),r&&e.jsx(v,{textAlign:"center",py:4,children:e.jsx(q,{})}),i&&e.jsx(m,{color:"error",textAlign:"center",children:"Failed to load questions."}),e.jsx(v,{display:"flex",flexWrap:"wrap",gap:2,children:S.map((p,P)=>e.jsx(v,{flex:"1 1 calc(33.33% - 16px)",minWidth:"300px",children:e.jsxs(L,{sx:{borderRadius:2},children:[e.jsx(G,{expandIcon:e.jsx(V,{}),children:e.jsxs(v,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(m,{fontWeight:600,flex:1,pr:1,children:p.question||p.title||"Untitled Question"}),e.jsx(Se,{label:p.category,color:"primary",variant:"outlined",size:"small"})]})}),e.jsx(H,{children:p.category==="MCQ"?e.jsx(v,{display:"flex",flexWrap:"wrap",gap:1,children:p.options?.map((C,N)=>e.jsx(v,{flex:"1 1 calc(50% - 8px)",children:e.jsxs(B,{elevation:1,sx:{p:1,bgcolor:C.isCorrect?"#dcfce7":"#f3f4f6",border:C.isCorrect?"1px solid #22c55e":"1px solid #d1d5db"},children:[String.fromCharCode(65+N),". ",C.text]})},C._id||N))}):e.jsxs(v,{mt:2,children:[e.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Answer:"}),e.jsx(B,{variant:"outlined",sx:{p:1},children:e.jsx(m,{children:p.answer||"Not Provided"})})]})})]})},p._id||P))}),e.jsx(v,{ref:f,display:"flex",justifyContent:"center",py:3,children:x&&e.jsx(q,{size:24})}),!o&&!r&&e.jsx(m,{textAlign:"center",mt:3,color:"text.secondary",children:"No more questions."})]})}export{Le as default};
