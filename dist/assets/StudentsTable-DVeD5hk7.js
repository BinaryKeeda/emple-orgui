import{r as n,Y as P,w as R,j as e,A as B,y as F,I as E,t as T,B as w}from"./index-68UMokMI.js";import{u as M}from"./useQuery-Dv6aDCKJ.js";import{T as q,a as z,S as L}from"./TextField-C3JwhYRB.js";import{I as U,S as W,T as _,a as O,b as H,c as j,d as t,e as K}from"./Search-nEIzSnAz.js";import{M as m}from"./MenuItem-C3t_Upzs.js";import{T as b}from"./Typography-D_11Rz1t.js";import{P as Q}from"./Modal-Dx7SlieA.js";import{D as Y}from"./Delete-Dpv4dHA1.js";import{D as G,a as J,b as V,c as X,d as Z}from"./DialogTitle-C3jyY33m.js";import{B as C}from"./Button-DovyfzvG.js";const ee=async(r,x,o,u,a,l)=>(await T.get(`${w}/api/campus/students/${r}?page=${x}&limit=${o}&search=${u}&role=${a}&status=${l}`,{withCredentials:!0})).data,me=()=>{const[r,x]=n.useState(""),[o,u]=n.useState(r),[a,l]=n.useState(1),[i,N]=n.useState("all"),[A,c]=n.useState(!1),[f,g]=n.useState(null),d=10,{id:h}=P(),{enqueueSnackbar:y}=R();n.useEffect(()=>{const s=setTimeout(()=>{u(r),l(1)},400);return()=>clearTimeout(s)},[r]);const{data:S,isLoading:D,refetch:I}=M({queryKey:["students",h,a,o,i],queryFn:()=>ee(h,a,d,o,"all",i)}),$=s=>{g(s),c(!0)},k=async()=>{if(f)try{await T.delete(`${w}/api/campus/students/${h}/${f}`,{withCredentials:!0}),y("Student removed successfully!",{variant:"success"}),I()}catch(s){console.error("Failed to remove student",s),y("Failed to remove student!",{variant:"error"})}finally{c(!1),g(null)}},v=S?.data||[],p=S?.total||0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(B,{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center",children:[e.jsx(q,{value:r,onChange:s=>x(s.target.value),size:"small",label:"Search by name or email",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(W,{})})},sx:{maxWidth:280}}),e.jsx(z,{size:"small",sx:{minWidth:160},children:e.jsxs(L,{value:i,onChange:s=>N(s.target.value),children:[e.jsx(m,{value:"all",children:"All Statuses"}),e.jsx(m,{value:"member",children:"Member"}),e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"admin",children:"Admin"})]})})]}),D?e.jsx(b,{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(_,{component:Q,className:"shadow mt-6 rounded-lg",children:e.jsxs(O,{children:[e.jsx(H,{className:"bg-orange-50",children:e.jsxs(j,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsxs(K,{children:[v.length===0&&e.jsx(j,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(b,{color:"textSecondary",children:"No students found"})})}),v.map(s=>e.jsxs(j,{hover:!0,children:[e.jsx(t,{children:s.name}),e.jsx(t,{children:s.email}),e.jsx(t,{children:s.role}),e.jsx(t,{children:s.status==="member"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded",children:"Member"}):s.status==="admin"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded",children:"Admin"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-yellow-700 bg-yellow-100 rounded",children:"Pending"})}),e.jsx(t,{children:e.jsx(F,{title:"Remove Student",children:e.jsx(E,{size:"small",color:"error",onClick:()=>$(s._id),children:e.jsx(Y,{})})})})]},s._id))]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs(b,{variant:"body2",color:"textSecondary",children:["Showing ",(a-1)*d+1," - ",Math.min(a*d,p)," of ",p]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:a===1,onClick:()=>l(s=>s-1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Prev"}),e.jsx("button",{disabled:a*d>=p,onClick:()=>l(s=>s+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Next"})]})]})]}),e.jsxs(G,{open:A,onClose:()=>c(!1),children:[e.jsx(J,{children:"Confirm Removal"}),e.jsx(V,{children:e.jsx(X,{children:"Are you sure you want to remove this student? This action cannot be undone."})}),e.jsxs(Z,{children:[e.jsx(C,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(C,{color:"error",onClick:k,children:"Remove"})]})]})]})};export{me as S};
