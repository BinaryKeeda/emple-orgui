import{c as ie,j as e,r as v,ai as P,A as le,aD as ce,M as de,H as d,z as l,K as ue,al as xe,N as x,C as R,x as D,B as O,I as b,aj as N,aE as pe,ab as he,ak as me,y as ge,P as A,aw as z,aF as je}from"./index-BKh3Z22c.js";import{r as fe,u as Q,w as ye}from"./xlsx-BTp1RmNK.js";import{p as be}from"./aikenParser-D2gryyxM.js";import{U as E}from"./Upload-Bye5JQXs.js";import{D as q}from"./Download-klB0yLSu.js";import{A as T,a as _,b as K}from"./AccordionSummary-BXMod9gV.js";const J=ie(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"})),Ce={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function ve({onSubmit:m}){const[t,c]=v.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[p,g]=v.useState(!1),u=P(),j=(s,o)=>{if(!t||!t.options)return;const n=[...t.options];n[s]={...n[s],text:o},c({...t,options:n})},f=s=>{if(!t||!t.options)return;const o=t?.options.map((n,S)=>({...n,isCorrect:S===s}));c({...t,options:o})},w=s=>{if(!t||!t.options)return;const o=[...t.options];o[s].isCorrect=!o[s].isCorrect,c({...t,options:o})},y=async()=>{try{g(!0),await m([t]),c({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),await u.invalidateQueries({queryKey:["questions"]})}catch(s){console.error(s)}finally{g(!1)}};return e.jsxs(d,{className:"space-y-4",children:[e.jsx(b,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:s=>c({...t,question:s.target.value})}),e.jsx(b,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:s=>c({...t,topic:s.target.value})}),e.jsx(b,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:s=>c({...t,marks:parseFloat(s.target.value)})}),e.jsx(b,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:s=>c({...t,negative:parseFloat(s.target.value)})}),e.jsxs(b,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:s=>{const o=s.target.value,n=Array(4).fill({text:"",isCorrect:!1});c({...t,category:o,options:n,answer:""})},children:[e.jsx(N,{value:"MCQ",children:"MCQ"}),e.jsx(N,{value:"MSQ",children:"MSQ"}),e.jsx(N,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(b,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:s=>c({...t,answer:s.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&e.jsxs(d,{children:[e.jsx(l,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options&&t.options.map((s,o)=>e.jsxs(d,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(pe,{size:"small",checked:s.isCorrect,onChange:()=>f(o)}):e.jsx(he,{size:"small",checked:s.isCorrect,onChange:()=>w(o)}),e.jsx(b,{size:"small",fullWidth:!0,label:`Option ${o+1}`,value:s.text,onChange:n=>j(o,n.target.value)})]},o))]}),e.jsx(x,{variant:"contained",onClick:y,disabled:p,children:p?"Submitting...":"Add Question"})]})}function we({open:m,onClose:t,onSuccess:c,bankId:p}){const[g,u]=v.useState(null),[j,f]=v.useState([]),w=P(),{enqueueSnackbar:y}=le(),{mutateAsync:s,isPending:o}=ce({mutationFn:async a=>{await D.post(`${O}/api/admin/add/questionbanks/questions/${p}/`,a,{withCredentials:!0})},onSuccess:()=>{y("Questions added successfully!",{variant:"success"}),w.invalidateQueries({queryKey:["questionBank",p]}),t(),c()},onError:a=>{y(a?.response?.data?.message||"Failed to add questions",{variant:"error"})}}),n=async a=>{const i=a.target.files?.[0];if(i)try{const r=await i.text(),h=JSON.parse(r);f(h)}catch{u("Invalid JSON format")}},S=async a=>{const i=a.target.files?.[0];if(i)try{const r=await i.arrayBuffer(),h=fe(r,{type:"array"}),H=h.Sheets[h.SheetNames[0]],G=Q.sheet_to_json(H).map(Y=>{const{question:V,category:X,marks:Z,negative:ee,topic:te,answer:se,option1:ae,correct1:B,option2:ne,correct2:F,option3:oe,correct3:U,option4:re,correct4:W}=Y,M={question:V||"",category:X||"MCQ",marks:parseFloat(Z)||1,negative:parseFloat(ee)||0,topic:te||""};return M.category==="Text"?{...M,answer:se||"",options:[]}:{...M,options:[{text:ae||"",isCorrect:B===!0||B==="true"},{text:ne||"",isCorrect:F===!0||F==="true"},{text:oe||"",isCorrect:U===!0||U==="true"},{text:re||"",isCorrect:W===!0||W==="true"}]}});f(G)}catch{u("Invalid Excel format")}},C=async a=>{const i=a.target.files?.[0];if(i)try{const r=await i.text(),h=be(r);if(h.length===0){u("No valid AIKEN questions found");return}u(null),f(h)}catch(r){console.error(r),u("Invalid AIKEN format")}},k=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",options:[{text:"Berlin",isCorrect:!1},{text:"Madrid",isCorrect:!1},{text:"Paris",isCorrect:!0},{text:"Rome",isCorrect:!1}]}],i=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.download="sample_questions.json",r.click()},L=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",option1:"Berlin",correct1:!1,option2:"Madrid",correct2:!1,option3:"Paris",correct3:!0,option4:"Rome",correct4:!1}],i=Q.json_to_sheet(a),r=Q.book_new();Q.book_append_sheet(r,i,"Sample"),ye(r,"sample_questions.xlsx")},$=()=>{const a=`What is the capital of France?
                    A. Berlin
                    B. Madrid
                    C. Paris
                    D. Rome
                    ANSWER: C`,i=new Blob([a],{type:"text/plain"}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.download="sample_questions.txt",r.click()},I=async a=>{await s(a)};return e.jsx(de,{open:m,onClose:t,children:e.jsxs(d,{sx:{...Ce,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsx(ue,{onClick:t,children:e.jsx(xe,{})})]}),e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap",children:[e.jsxs(x,{variant:"outlined",component:"label",startIcon:e.jsx(E,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:n})]}),e.jsx(x,{startIcon:e.jsx(q,{}),onClick:k,children:"Download Sample"}),e.jsxs(x,{variant:"outlined",component:"label",startIcon:e.jsx(E,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:S})]}),e.jsx(x,{startIcon:e.jsx(q,{}),onClick:L,children:"Download Sample"}),e.jsxs(x,{variant:"outlined",component:"label",startIcon:e.jsx(E,{fontSize:"small"}),children:["Upload AIKEN (.txt)",e.jsx("input",{type:"file",accept:".txt",hidden:!0,onChange:C})]}),e.jsx(x,{startIcon:e.jsx(q,{}),onClick:$,children:"Download Sample"})]}),g&&e.jsx(l,{color:"error",variant:"body2",className:"mb-2",children:g}),e.jsx(l,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(ve,{onSubmit:I}),j.length>0&&e.jsxs(d,{className:"mt-6",children:[e.jsxs(l,{variant:"subtitle1",className:"mb-2 font-semibold",children:["Preview Uploaded Questions (",j.length,")"]}),j.map((a,i)=>e.jsxs(T,{defaultExpanded:i===0,children:[e.jsx(_,{expandIcon:e.jsx(J,{}),children:e.jsxs(l,{children:["Q",i+1,": ",a.question.slice(0,80),"..."]})}),e.jsxs(K,{children:[e.jsxs(l,{children:[e.jsx("strong",{children:"Topic:"})," ",a.topic]}),e.jsxs(l,{children:[e.jsx("strong",{children:"Marks:"})," ",a.marks]}),e.jsxs(l,{children:[e.jsx("strong",{children:"Negative:"})," ",a.negative]}),e.jsxs(l,{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),(a.category==="MCQ"||a.category==="MSQ")&&e.jsx(d,{className:"mt-2 space-y-1",children:a.options?.map((r,h)=>e.jsxs(l,{children:[r.isCorrect?"✅":"⬜️"," Option ",h+1,": ",r.text]},h))})]})]},i)),e.jsx(x,{className:"mt-4",variant:"contained",disabled:o,onClick:()=>I(j),children:o?"Submitting...":"Submit All Previewed Questions"})]}),o&&e.jsx(R,{className:"mt-4"})]})})}function Ie(){const{slug:m=""}=me(),[t,c]=v.useState(!1),[p,g]=v.useState(1),{data:u,isLoading:j,isError:f,refetch:w}=ge({queryKey:["questionBank",m,p],queryFn:async()=>(await D.get(`${O}/api/admin/get/questionbank/questions/${m}?page=${p}&limit=50`,{withCredentials:!0})).data,enabled:m!==""}),y=u?.bankDetails,s=u?.questions??[],o=u?.hasMore??!1;return e.jsxs(d,{mx:"auto",px:2,py:4,children:[e.jsxs(A,{elevation:3,sx:{p:4,borderRadius:3,mb:5,display:"flex",flexDirection:"column",gap:2},children:[t&&e.jsx(we,{open:!0,onSuccess:()=>{c(!1),w()},onClose:()=>c(!1),bankId:m}),e.jsx(l,{variant:"h5",fontWeight:"bold",children:y?.name||"Question Bank"}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Category: ",y?.category||"N/A"]}),e.jsx(z,{direction:"row",spacing:2,mt:1,children:e.jsx(x,{variant:"contained",color:"primary",onClick:()=>c(!0),sx:{textTransform:"none",borderRadius:2},children:"Add Question"})})]}),j&&e.jsx(d,{textAlign:"center",py:4,children:e.jsx(R,{})}),f&&e.jsx(l,{color:"error",textAlign:"center",children:"Failed to load questions."}),e.jsx(d,{display:"flex",flexWrap:"wrap",gap:2,children:s.map((n,S)=>e.jsx(d,{flex:"1 1 calc(33.33% - 16px)",minWidth:"300px",children:e.jsxs(T,{sx:{borderRadius:2},children:[e.jsx(_,{expandIcon:e.jsx(J,{}),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(l,{fontWeight:600,flex:1,pr:1,children:n.question||n.title||"Untitled Question"}),e.jsx(je,{label:n.category,color:"primary",variant:"outlined",size:"small"})]})}),e.jsx(K,{children:n.category==="MCQ"?e.jsx(d,{display:"flex",flexWrap:"wrap",gap:1,children:n.options?.map((C,k)=>e.jsx(d,{flex:"1 1 calc(50% - 8px)",children:e.jsxs(A,{elevation:1,sx:{p:1,bgcolor:C.isCorrect?"#dcfce7":"#f3f4f6",border:C.isCorrect?"1px solid #22c55e":"1px solid #d1d5db"},children:[String.fromCharCode(65+k),". ",C.text]})},C._id||k))}):e.jsxs(d,{mt:2,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Answer:"}),e.jsx(A,{variant:"outlined",sx:{p:1},children:e.jsx(l,{children:n.answer||"Not Provided"})})]})})]})},n._id||S))}),e.jsxs(z,{direction:"row",justifyContent:"center",alignItems:"center",spacing:2,mt:4,children:[e.jsx(x,{variant:"outlined",disabled:p===1,onClick:()=>g(n=>n-1),children:"Previous"}),e.jsxs(l,{fontWeight:"bold",children:["Page ",p]}),e.jsx(x,{variant:"outlined",disabled:!o,onClick:()=>g(n=>n+1),children:"Next"})]})]})}export{Ie as default};
