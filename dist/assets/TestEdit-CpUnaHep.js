const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddTestProblemModal-CYaAJ2Mn.js","assets/index-I3XiM4Qn.js","assets/index-B0jEptJo.css","assets/AddTestSectionQuestionsModal-DR-yqJ1D.js","assets/xlsx-DSqvgYLF.js","assets/Upload-ZpAtT8-_.js"])))=>i.map(i=>d[i]);
import{ag as $,r as l,j as e,C as k,z as u,a5 as r,af as n,R as m,P as D,I as O,a8 as W,x as g,B as p,aJ as T}from"./index-I3XiM4Qn.js";import{A as L}from"./Add-BGvXjk9Y.js";import{A as R,a as V,b as B}from"./AccordionSummary-DO3WS7vY.js";const G=l.lazy(()=>T(()=>import("./AddTestProblemModal-CYaAJ2Mn.js"),__vite__mapDeps([0,1,2]))),J=l.lazy(()=>T(()=>import("./AddTestSectionQuestionsModal-DR-yqJ1D.js"),__vite__mapDeps([3,1,2,4,5])));function X(){const{slug:d}=$(),[a,i]=l.useState(null),[_,j]=l.useState(!0),[y,P]=l.useState(null),[o,x]=l.useState({name:"",sectionType:"Quiz"}),[b,v]=l.useState(!1),[f,C]=l.useState(!1),[Q,N]=l.useState(null),[w,S]=l.useState(null),M=s=>N(s),A=()=>N(null),E=s=>S(s),z=()=>S(null),h=async()=>{try{j(!0);const s=await g.get(`${p}/api/admin/tests/${d}`,{withCredentials:!0});i(s.data.data)}catch(s){console.error(s),P("Failed to fetch test")}finally{j(!1)}};l.useEffect(()=>{d&&h()},[d]);const I=async()=>{try{v(!0);const s=await g.post(`${p}/api/admin/tests/${d}/sections`,o,{withCredentials:!0});i(s.data.data),x({name:"",sectionType:"Quiz"})}catch(s){console.error("Failed to add section",s),alert("Failed to add section")}finally{v(!1)}},F=async()=>{if(a)try{C(!0);const s=await g.put(`${p}/api/admin/tests/update/${d}`,a,{withCredentials:!0});i(s.data.data)}catch(s){console.error("Failed to update test",s),alert("Failed to save changes")}finally{C(!1)}};return _?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{})}):y?e.jsx(u,{color:"error",children:y}):a?e.jsxs("div",{className:"p-6 md:p-10 bg-gray-50 min-h-screen",children:[e.jsxs("h4",{className:"font-bold mb-6 text-gray-800 text-xl",children:["Edit Test - ",a.name]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(r,{size:"small",label:"Test Name",value:a.name,onChange:s=>i({...a,name:s.target.value}),fullWidth:!0}),e.jsx(r,{size:"small",label:"Duration (minutes)",type:"number",value:a.duration??"",onChange:s=>i({...a,duration:parseInt(s.target.value,10)||0}),fullWidth:!0}),e.jsx(r,{label:"Description",size:"small",value:a.description??"",onChange:s=>i({...a,description:s.target.value}),fullWidth:!0,multiline:!0,rows:3}),e.jsxs(r,{select:!0,size:"small",label:"Category",value:a.category,onChange:s=>i({...a,category:s.target.value}),fullWidth:!0,children:[e.jsx(n,{value:"Placements",children:"Placements"}),e.jsx(n,{value:"Gate",children:"Gate"})]}),e.jsxs(r,{select:!0,size:"small",label:"Visibility",value:a.visibility,onChange:s=>i({...a,visibility:s.target.value}),fullWidth:!0,children:[e.jsx(n,{value:"private",children:"Private"}),e.jsx(n,{value:"public",children:"Public"}),e.jsx(n,{value:"group",children:"Group"})]}),e.jsxs(r,{select:!0,size:"small",label:"Availability",value:a.isAvailable?"true":"false",onChange:s=>i({...a,isAvailable:s.target.value==="true"}),fullWidth:!0,children:[e.jsx(n,{value:"true",children:"Available"}),e.jsx(n,{value:"false",children:"Not Available"})]})]}),e.jsx(m,{variant:"contained",color:"primary",onClick:F,disabled:f,className:"mb-8",children:f?"Saving...":"Save Changes"}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"font-medium mb-2 pl-1 text-gray-700",children:"Add New Section"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(r,{size:"small",label:"Section Name",value:o.name,onChange:s=>x({...o,name:s.target.value})}),e.jsxs(r,{size:"small",select:!0,label:"Type",value:o.sectionType,onChange:s=>x({...o,sectionType:s.target.value}),children:[e.jsx(n,{value:"Quiz",children:"Quiz"}),e.jsx(n,{value:"Coding",children:"Coding"})]}),e.jsx(m,{variant:"contained",startIcon:e.jsx(L,{}),onClick:I,disabled:b||!o.name,children:b?"Adding...":"Add Section"})]})]}),e.jsx("h2",{className:"font-semibold pl-1 mt-6 mb-4 text-gray-700 text-lg",children:"Sections"}),a.sections.length===0&&e.jsx("p",{className:"text-gray-500 italic mb-4",children:"No sections added yet."}),a.sections.map(s=>e.jsxs(D,{elevation:0,className:"p-4 relative border-gray-100 mb-4 shadow-sm border rounded-lg bg-white",children:[e.jsx(O,{sx:{position:"absolute",right:8,top:8},children:e.jsx(W,{sx:{fontSize:18}})}),e.jsx(u,{className:"font-semibold text-lg",children:s.name}),e.jsxs(u,{variant:"body2",color:"textSecondary",children:["Type:"," ",s.sectionType==="Quiz"?`Quiz Questions ${s.questionSet?.length||0}`:`Coding Problems ${s.problemset?.length||0}`]}),e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[s.sectionType==="Quiz"&&e.jsx(m,{size:"small",variant:"outlined",onClick:()=>E(s._id),children:"Add Questions"}),s.sectionType==="Coding"&&e.jsx(m,{size:"small",variant:"outlined",onClick:()=>M(s._id),children:"Add Problems"}),e.jsxs(R,{children:[e.jsx(V,{children:s.sectionType==="Quiz"?"View Questions":"View Problems"}),e.jsx(B,{children:s.sectionType==="Quiz"?s.questionSet?.length?e.jsx("ul",{className:"list-disc ml-6 space-y-2 text-sm text-gray-800",children:s.questionSet.map((t,c)=>e.jsxs("li",{children:[e.jsx("strong",{children:t.question||`Question ${c+1}`}),e.jsx("br",{}),e.jsx("span",{className:"text-gray-600",children:"Type:"})," ",t.category,e.jsx("br",{}),t.difficulty&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"Difficulty:"})," ",t.difficulty,e.jsx("br",{})]}),t.marks&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"Marks:"})," ",t.marks]})]},t._id||c))}):e.jsx("p",{className:"text-gray-500 italic",children:"No questions added yet."}):s.problemset?.length?e.jsx("ul",{className:"list-disc ml-6 space-y-2 text-sm text-gray-800",children:s.problemset.map((t,c)=>e.jsxs("li",{children:[e.jsx("strong",{children:t.title||`Problem ${c+1}`}),e.jsx("br",{}),t.difficulty&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"Difficulty:"})," ",t.difficulty,e.jsx("br",{})]}),Array.isArray(t.tags)&&t.tags.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"Tags:"})," ",t.tags.join(", ")]})]},t._id||c))}):e.jsx("p",{className:"text-gray-500 italic",children:"No problems added yet."})})]})]}),e.jsxs(l.Suspense,{fallback:e.jsx("div",{children:"Loading modal..."}),children:[w===s._id&&s.sectionType==="Quiz"&&e.jsx(J,{open:!0,onClose:z,testId:d,sectionId:s._id,onSuccess:()=>{h(),z()}}),Q===s._id&&s.sectionType==="Coding"&&e.jsx(G,{open:!0,onClose:A,testId:d,sectionId:s._id,onSuccess:()=>{h(),A()}})]})]},s._id))]}):e.jsx(u,{children:"No test found."})}export{X as default};
