import{U as de,V as me,r as l,W as he,G as pe,X as xe,q as E,j as e,A as z,t as Q,B as U,w as Y,C as _,x as B,Y as J,h as fe,I as G}from"./index-DIURjhAd.js";import{M as K,P as ge}from"./Modal-aMNQSBK5.js";import{T as b,F as je,S as ve}from"./TextField-CLyTsw8R.js";import{M as w}from"./MenuItem-CGARwiIG.js";import{B as N}from"./Button-BXEi_mMv.js";import{T as $}from"./Typography-BrV-ZvW1.js";import{u as be}from"./useQuery-DKyb2Rjj.js";import{r as ye,u as A,w as Ce}from"./xlsx-DSqvgYLF.js";import{g as X}from"./userSelector-C6liUQHe.js";import{D as Se,b as we}from"./DialogTitle-DsJKiJmL.js";import{C as Te,U as Me}from"./UploadFile-CuGeIPH0.js";import{T as ze,a as ke,b as Ne,c as H,d as M,e as Ee}from"./TableRow-BsXJunwG.js";import{D as Ie}from"./Delete-CQw06rrR.js";import{T as Pe}from"./TablePagination-D695FMyu.js";import{S as De}from"./StudentsTable-Bbu1uR33.js";import"./dividerClasses-CkepYj8H.js";import"./Search-CJgmTVSw.js";function Ae(i){const{theme:a,name:s,props:t}=i;return!a||!a.components||!a.components[s]||!a.components[s].defaultProps?t:de(a.components[s].defaultProps,t)}function Qe(i,a,s,t,h){const[n,j]=l.useState(()=>h&&s?s(i).matches:t?t(i).matches:a);return pe(()=>{if(!s)return;const u=s(i),c=()=>{j(u.matches)};return c(),u.addEventListener("change",c),()=>{u.removeEventListener("change",c)}},[i,s]),n}const Ue={...he},Z=Ue.useSyncExternalStore;function Le(i,a,s,t,h){const n=l.useCallback(()=>a,[a]),j=l.useMemo(()=>{if(h&&s)return()=>s(i).matches;if(t!==null){const{matches:r}=t(i);return()=>r}return n},[n,i,t,h,s]),[u,c]=l.useMemo(()=>{if(s===null)return[n,()=>()=>{}];const r=s(i);return[()=>r.matches,p=>(r.addEventListener("change",p),()=>{r.removeEventListener("change",p)})]},[n,s,i]);return Z(c,u,j)}function ee(i={}){const{themeId:a}=i;return function(t,h={}){let n=me();n&&a&&(n=n[a]||n);const j=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:u=!1,matchMedia:c=j?window.matchMedia:null,ssrMatchMedia:v=null,noSsr:r=!1}=Ae({name:"MuiUseMediaQuery",props:h,theme:n});let p=typeof t=="function"?t(n):t;return p=p.replace(/^@media( ?)/m,""),p.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(Z!==void 0?Le:Qe)(p,u,c,v,r)}}ee();const Re=ee({themeId:xe}),We=E(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),Fe=E(e.jsx("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"})),He=E(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),_e=E(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),Be=E([e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-5.99 13c-.59 0-1.05-.47-1.05-1.05 0-.59.47-1.04 1.05-1.04.59 0 1.04.45 1.04 1.04-.01.58-.45 1.05-1.04 1.05m2.5-6.17c-.63.93-1.23 1.21-1.56 1.81-.13.24-.18.4-.18 1.18h-1.52c0-.41-.06-1.08.26-1.65.41-.73 1.18-1.16 1.63-1.8.48-.68.21-1.94-1.14-1.94-.88 0-1.32.67-1.5 1.23l-1.37-.57C11.51 5.96 12.52 5 13.99 5c1.23 0 2.08.56 2.51 1.26.37.61.58 1.73.01 2.57"},"1")]),$e=E(e.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"})),Ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Oe=({open:i,onClose:a,sectionId:s})=>{const[t,h]=l.useState(""),[n,j]=l.useState(0),[u,c]=l.useState(30),[v,r]=l.useState("Core"),[p,f]=l.useState("Medium"),[y,d]=l.useState(""),[T,S]=l.useState(!1),[I,L]=l.useState(!1),R=async()=>{if(!t.trim()){d("Quiz title is required"),S(!0);return}if(n<=0){d("Marks must be greater than 0"),S(!0);return}if(u<=0){d("Duration must be greater than 0"),S(!0);return}L(!0),d(""),S(!1);try{const g=await Q.post(`${U}/api/campus/create/quiz/${s}`,{title:t,marks:n,duration:u,category:v,difficulty:p,sectionId:s},{withCredentials:!0});g.data.success?(d("Quiz created successfully!"),S(!1),h(""),j(0),c(30),r("Core"),f("Medium")):(d(g.data.message||"Failed to create quiz"),S(!0))}catch(g){console.error(g),d(g?.response?.data?.message||"Internal Server Error"),S(!0)}finally{L(!1)}};return e.jsx(K,{open:i,onClose:a,children:e.jsx(z,{sx:Ve,children:e.jsxs(z,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Quiz Title",value:t,onChange:g=>h(g.target.value),fullWidth:!0}),e.jsxs(z,{display:"flex",gap:2,children:[e.jsx(b,{label:"Marks",type:"number",value:n,onChange:g=>j(Number(g.target.value)),fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",type:"number",value:u,onChange:g=>c(Number(g.target.value)),fullWidth:!0})]}),e.jsxs(z,{display:"flex",gap:2,children:[e.jsxs(b,{select:!0,label:"Category",value:v,onChange:g=>r(g.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Core",children:"Core"}),e.jsx(w,{value:"Aptitude",children:"Aptitude"}),e.jsx(w,{value:"Misc",children:"Misc"})]}),e.jsxs(b,{select:!0,label:"Difficulty",value:p,onChange:g=>f(g.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Easy",children:"Easy"}),e.jsx(w,{value:"Medium",children:"Medium"}),e.jsx(w,{value:"Hard",children:"Hard"})]})]}),e.jsx(N,{sx:{backgroundColor:"#FF5C01",color:"#ffffff"},variant:"contained",color:"primary",onClick:R,disabled:I,children:I?"Creating...":"Create Quiz"}),y&&e.jsx($,{textAlign:"center",color:T?"error":"success.main",children:y})]})})})},qe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Ge={name:"",description:"",duration:30,visibility:"private",category:"Placements"},Ye=({open:i,onClose:a,sectionId:s})=>{const[t,h]=l.useState(Ge),[n,j]=l.useState(!1),{enqueueSnackbar:u}=Y(),c=r=>{const{name:p,value:f}=r.target;h(y=>({...y,[p]:p==="duration"?Number(f):f}))},v=async()=>{if(!t.name.trim()){u("Test name is required",{variant:"error"});return}if(t.duration<=0){u("Duration must be greater than 0",{variant:"error"});return}j(!0);try{await Q.post(`${U}/api/campus/create/test/${s}`,t,{withCredentials:!0}),u("âœ… Test created successfully!",{variant:"success"}),a()}catch(r){console.error(r),u(r?.response?.data?.error||"Internal Server Error",{variant:"error"})}finally{j(!1)}};return e.jsx(K,{open:i,onClose:a,children:e.jsxs(z,{sx:qe,children:[e.jsx($,{variant:"h6",fontWeight:"bold",mb:3,children:"Create New Test"}),e.jsxs(z,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Test Name",name:"name",value:t.name,onChange:c,fullWidth:!0}),e.jsx(b,{label:"Description",name:"description",value:t.description,onChange:c,multiline:!0,rows:3,fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",name:"duration",type:"number",value:t.duration,onChange:c,fullWidth:!0}),e.jsxs(b,{select:!0,label:"Category",name:"category",value:t.category,onChange:c,fullWidth:!0,children:[e.jsx(w,{value:"Placements",children:"Placements"}),e.jsx(w,{value:"Gate",children:"Gate"})]}),e.jsx(N,{variant:"contained",color:"primary",onClick:v,disabled:n,sx:{backgroundColor:"#FF5C01",color:"#ffffff"},children:n?e.jsx(_,{size:20}):"Create Test"})]})]})})};function Je({open:i,setOpen:a}){const[s,t]=l.useState([]),[h,n]=l.useState(null);console.log(h);const[j,u]=l.useState(!1),[c,v]=l.useState(null),[r,p]=l.useState(0),[f,y]=l.useState(5),[d,T]=l.useState(""),[S,I]=l.useState(!1),R=B(o=>o.auth.user)?.user._id,{id:g}=J(),se=B(X),te=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,{enqueueSnackbar:W}=Y(),ae=fe(),V=Re(ae.breakpoints.down("sm")),ne=async o=>{if(o.preventDefault(),s.length===0){v("Please add at least one valid email");return}if(s.filter(m=>m.role==="campus-admin").length>5){v("You can only invite up to 5 campus-admins at a time.");return}I(!0),W("Processing invites...",{variant:"info"});try{const m=s.map(P=>({email:P.email,name:P.name||"Unknown",role:P.role,groupId:se,sectionId:g,invitedBy:R})),k=await Q.post(`${U}/api/campus/section/add`,{invites:m},{withCredentials:!0});n(k.data),t([]),v(null),W("Invite send successfully",{variant:"success"}),a(!1)}catch(m){n({error:m.response?.data||m.message}),W("Error sending",{variant:"success"})}finally{I(!1)}},re=()=>{t(o=>[...o,{email:"",name:"",role:"user"}])},le=o=>{const x=o.target.files?.[0];if(!x)return;u(!0);const m=new FileReader;m.onload=k=>{const P=new Uint8Array(k.target?.result),O=ye(P,{type:"array"}),ce=O.Sheets[O.SheetNames[0]],q=A.sheet_to_json(ce).map(C=>({email:C.Email?.trim(),name:C.Name?.trim()||"Unknown",role:C.Role&&["user","campus-admin"].includes(C.Role)?C.Role:"user"})).filter(C=>C.email&&te.test(C.email)&&!s.some(ue=>ue.email===C.email));q.length===0?v("No valid users found in file"):(t(C=>[...C,...q]),v(null)),u(!1)},m.readAsArrayBuffer(x)},oe=()=>{const o=[{Name:"John Doe",Email:"user1@example.com",Role:"user"},{Name:"Jane Smith",Email:"user2@example.com",Role:"campus-admin"}],x=A.json_to_sheet(o),m=A.book_new();A.book_append_sheet(m,x,"Users"),Ce(m,"sample_users.xlsx")},F=(o,x,m)=>{const k=[...s];k[o][x]=m,t(k)},ie=o=>{const x=[...s];x.splice(o,1),t(x)},D=l.useMemo(()=>d?s.filter(o=>o.email.toLowerCase().includes(d.toLowerCase())||o.name.toLowerCase().includes(d.toLowerCase())):s,[d,s]);return e.jsx(e.Fragment,{children:e.jsx(Se,{maxWidth:"xl",fullWidth:!0,open:i,onClose:()=>a(!1),fullScreen:V,PaperProps:{sx:{p:3,height:V?"100%":"90vh"}},children:e.jsxs(we,{className:"flex flex-col gap-3",sx:{overflowY:"auto"},children:[e.jsx($,{variant:"h5",mb:2,align:"center",children:"Add Members"}),e.jsx(G,{onClick:()=>a(!1),sx:{position:"absolute",right:5,top:3},children:e.jsx(Te,{})}),e.jsx(b,{size:"small",fullWidth:!0,placeholder:"Search by name or email",value:d,onChange:o=>T(o.target.value),sx:{mb:2}}),e.jsxs("form",{onSubmit:ne,className:"flex flex-col gap-3",children:[c&&e.jsx(je,{error:!0,children:c}),e.jsxs(z,{display:"flex",gap:1,children:[e.jsxs(N,{variant:"outlined",size:"small",startIcon:e.jsx(Me,{}),component:"label",disabled:j,children:[j?e.jsx(_,{size:18}):"Upload",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.csv",onChange:le})]}),e.jsx(N,{variant:"outlined",size:"small",startIcon:e.jsx(He,{}),onClick:oe,children:"Sample"}),e.jsx(N,{variant:"outlined",size:"small",onClick:re,children:"Add +"})]}),e.jsxs(ze,{component:ge,sx:{mt:2},children:[e.jsxs(ke,{size:"small",children:[e.jsx(Ne,{children:e.jsxs(H,{children:[e.jsx(M,{children:"Email"}),e.jsx(M,{children:"Name"}),e.jsx(M,{children:"Role"}),e.jsx(M,{children:"Action"})]})}),e.jsx(Ee,{children:D.length>0?D.slice(r*f,r*f+f).map((o,x)=>e.jsxs(H,{children:[e.jsx(M,{children:e.jsx(b,{fullWidth:!0,size:"small",value:o.email,onChange:m=>F(r*f+x,"email",m.target.value)})}),e.jsx(M,{children:e.jsx(b,{size:"small",fullWidth:!0,value:o.name,onChange:m=>F(r*f+x,"name",m.target.value)})}),e.jsx(M,{children:e.jsxs(ve,{fullWidth:!0,size:"small",value:o.role,onChange:m=>F(r*f+x,"role",m.target.value),children:[e.jsx(w,{value:"user",children:"User"}),e.jsx(w,{value:"campus-admin",children:"Campus Admin"})]})}),e.jsx(M,{children:e.jsx(G,{color:"error",onClick:()=>ie(r*f+x),children:e.jsx(Ie,{})})})]},x)):e.jsx(H,{children:e.jsx(M,{colSpan:4,align:"center",children:"No users added yet"})})})]}),D.length>0&&e.jsx(Pe,{component:"div",count:D.length,page:r,onPageChange:(o,x)=>p(x),rowsPerPage:f,onRowsPerPageChange:o=>{y(parseInt(o.target.value,10)),p(0)}})]}),e.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:18,sx:{mr:1}}),"Processing..."]}):"Send Invites"})]})]})})})}const Ke=async({sectionId:i,groupId:a})=>a?(await Q.get(`${U}/api/campus/insights/${i}/${a}`,{withCredentials:!0})).data:null,fs=()=>{const[i,a]=l.useState(!1),[s,t]=l.useState(!1),{id:h}=J(),n=B(X)??"",[j,u]=l.useState(!1),{data:c,isLoading:v,isError:r,refetch:p}=be({queryKey:["sectionInsights",h,n],queryFn:()=>Ke({sectionId:h,groupId:n}),enabled:!!h&&!!n,staleTime:1e3*60*5}),f=[{label:"Total Users",value:c?.totalUsers??0,icon:e.jsx(_e,{className:"text-orange-600"})},{label:"Total Quizzes",value:c?.totalQuizzes??0,icon:e.jsx(Be,{className:"text-orange-600"})},{label:"Quiz Submissions",value:c?.totalQuizSubmissions??0,icon:e.jsx(We,{className:"text-orange-600"})},{label:"Total Tests",value:c?.totalTests??0,icon:e.jsx($e,{className:"text-orange-600"})},{label:"Test Submissions",value:c?.totalTestSubmissions??0,icon:e.jsx(Fe,{className:"text-orange-600"})}],y=({onClick:d,label:T})=>e.jsxs("button",{onClick:d,className:"flex cursor-pointer items-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200",children:[e.jsx("span",{children:T}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]});return e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx(Je,{open:j,setOpen:()=>u(!1)}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(y,{label:"Add Quiz",onClick:()=>a(!0)}),e.jsx(y,{label:"Add Test",onClick:()=>t(!0)}),e.jsx("div",{className:"relative group",children:e.jsx(y,{label:"Add Members",onClick:()=>u(!0)})})]}),v&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((d,T)=>e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse rounded-2xl"},T))}),r&&e.jsxs("div",{className:"text-red-600 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium",children:"Failed to fetch insights."}),e.jsx("button",{onClick:()=>p(),className:"underline text-sm hover:text-red-800",children:"Retry"})]}),!v&&!r&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:f.map((d,T)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md hover:shadow-lg transition-all duration-200 p-5 flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full mb-3",children:d.icon}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:d.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d.value})]},T))}),e.jsx(Oe,{open:i,onClose:()=>a(!1),sectionId:h}),e.jsx(Ye,{open:s,onClose:()=>t(!1),sectionId:h}),e.jsx(De,{})]})};export{fs as default};
