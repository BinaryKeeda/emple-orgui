import{U as me,V as he,r,W as pe,G as xe,X as fe,q as P,j as e,A as N,t as L,B as F,C as _,x as B,Y as q,h as ge,I as G}from"./index-68UMokMI.js";import{M as J,P as je}from"./Modal-Dx7SlieA.js";import{T as S,F as ve,S as be}from"./TextField-C3JwhYRB.js";import{M as z}from"./MenuItem-C3t_Upzs.js";import{B as A}from"./Button-DovyfzvG.js";import{T as U}from"./Typography-D_11Rz1t.js";import{u as ye}from"./useQuery-Dv6aDCKJ.js";import{r as Se,u as R,w as Ce}from"./xlsx-DSqvgYLF.js";import{g as K}from"./userSelector-C6liUQHe.js";import{D as we,b as ze}from"./DialogTitle-C3jyY33m.js";import{C as Me,U as Te}from"./UploadFile-DrYSgM8U.js";import{T as ke,a as Ne,b as Ee,c as H,d as T,e as Ie}from"./Search-nEIzSnAz.js";import{D as Ae}from"./Delete-Dpv4dHA1.js";import{T as Pe}from"./TablePagination-Bnl9jLQJ.js";import{S as De,A as Qe}from"./Snackbar-Dvac_WwR.js";import{S as Re}from"./StudentsTable-DVeD5hk7.js";import"./dividerClasses-H2CBsEGM.js";function Ue(i){const{theme:l,name:s,props:t}=i;return!l||!l.components||!l.components[s]||!l.components[s].defaultProps?t:me(l.components[s].defaultProps,t)}function Le(i,l,s,t,h){const[o,j]=r.useState(()=>h&&s?s(i).matches:t?t(i).matches:l);return xe(()=>{if(!s)return;const c=s(i),d=()=>{j(c.matches)};return d(),c.addEventListener("change",d),()=>{c.removeEventListener("change",d)}},[i,s]),o}const Fe={...pe},X=Fe.useSyncExternalStore;function We(i,l,s,t,h){const o=r.useCallback(()=>l,[l]),j=r.useMemo(()=>{if(h&&s)return()=>s(i).matches;if(t!==null){const{matches:a}=t(i);return()=>a}return o},[o,i,t,h,s]),[c,d]=r.useMemo(()=>{if(s===null)return[o,()=>()=>{}];const a=s(i);return[()=>a.matches,u=>(a.addEventListener("change",u),()=>{a.removeEventListener("change",u)})]},[o,s,i]);return X(d,c,j)}function Z(i={}){const{themeId:l}=i;return function(t,h={}){let o=he();o&&l&&(o=o[l]||o);const j=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:c=!1,matchMedia:d=j?window.matchMedia:null,ssrMatchMedia:v=null,noSsr:a=!1}=Ue({name:"MuiUseMediaQuery",props:h,theme:o});let u=typeof t=="function"?t(o):t;return u=u.replace(/^@media( ?)/m,""),u.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(X!==void 0?We:Le)(u,c,d,v,a)}}Z();const He=Z({themeId:fe}),_e=P(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),Be=P(e.jsx("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"})),$e=P(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),Oe=P(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),Ve=P([e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-5.99 13c-.59 0-1.05-.47-1.05-1.05 0-.59.47-1.04 1.05-1.04.59 0 1.04.45 1.04 1.04-.01.58-.45 1.05-1.04 1.05m2.5-6.17c-.63.93-1.23 1.21-1.56 1.81-.13.24-.18.4-.18 1.18h-1.52c0-.41-.06-1.08.26-1.65.41-.73 1.18-1.16 1.63-1.8.48-.68.21-1.94-1.14-1.94-.88 0-1.32.67-1.5 1.23l-1.37-.57C11.51 5.96 12.52 5 13.99 5c1.23 0 2.08.56 2.51 1.26.37.61.58 1.73.01 2.57"},"1")]),Ge=P(e.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"})),Ye={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},qe=({open:i,onClose:l,sectionId:s})=>{const[t,h]=r.useState(""),[o,j]=r.useState(0),[c,d]=r.useState(30),[v,a]=r.useState("Core"),[u,g]=r.useState("Medium"),[y,x]=r.useState(""),[M,p]=r.useState(!1),[C,E]=r.useState(!1),k=async()=>{if(!t.trim()){x("Quiz title is required"),p(!0);return}if(o<=0){x("Marks must be greater than 0"),p(!0);return}if(c<=0){x("Duration must be greater than 0"),p(!0);return}E(!0),x(""),p(!1);try{const b=await L.post(`${F}/api/campus/create/quiz/${s}`,{title:t,marks:o,duration:c,category:v,difficulty:u,sectionId:s},{withCredentials:!0});b.data.success?(x("Quiz created successfully!"),p(!1),h(""),j(0),d(30),a("Core"),g("Medium")):(x(b.data.message||"Failed to create quiz"),p(!0))}catch(b){console.error(b),x(b?.response?.data?.message||"Internal Server Error"),p(!0)}finally{E(!1)}};return e.jsx(J,{open:i,onClose:l,children:e.jsx(N,{sx:Ye,children:e.jsxs(N,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(S,{label:"Quiz Title",value:t,onChange:b=>h(b.target.value),fullWidth:!0}),e.jsxs(N,{display:"flex",gap:2,children:[e.jsx(S,{label:"Marks",type:"number",value:o,onChange:b=>j(Number(b.target.value)),fullWidth:!0}),e.jsx(S,{label:"Duration (minutes)",type:"number",value:c,onChange:b=>d(Number(b.target.value)),fullWidth:!0})]}),e.jsxs(N,{display:"flex",gap:2,children:[e.jsxs(S,{select:!0,label:"Category",value:v,onChange:b=>a(b.target.value),fullWidth:!0,children:[e.jsx(z,{value:"Core",children:"Core"}),e.jsx(z,{value:"Aptitude",children:"Aptitude"}),e.jsx(z,{value:"Misc",children:"Misc"})]}),e.jsxs(S,{select:!0,label:"Difficulty",value:u,onChange:b=>g(b.target.value),fullWidth:!0,children:[e.jsx(z,{value:"Easy",children:"Easy"}),e.jsx(z,{value:"Medium",children:"Medium"}),e.jsx(z,{value:"Hard",children:"Hard"})]})]}),e.jsx(A,{sx:{backgroundColor:"#FF5C01",color:"#ffffff"},variant:"contained",color:"primary",onClick:k,disabled:C,children:C?"Creating...":"Create Quiz"}),y&&e.jsx(U,{textAlign:"center",color:M?"error":"success.main",children:y})]})})})},Je={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Y={name:"",description:"",duration:30,visibility:"private",category:"Placements"},Ke=({open:i,onClose:l,sectionId:s})=>{const[t,h]=r.useState(Y),[o,j]=r.useState(!1),[c,d]=r.useState(""),[v,a]=r.useState(!1),u=y=>{const{name:x,value:M}=y.target;h(p=>({...p,[x]:x==="duration"?Number(M):M}))},g=async()=>{if(!t.name.trim()){d("Test name is required"),a(!0);return}if(t.duration<=0){d("Duration must be greater than 0"),a(!0);return}j(!0),d(""),a(!1);try{const y=await L.post(`${F}/api/campus/create/test/${s}`,t,{withCredentials:!0});y.data?.data?(d("Test created successfully!"),a(!1),h(Y)):(d(y.data?.error||"Failed to create test"),a(!0))}catch(y){console.error(y),d(y?.response?.data?.error||"Internal Server Error"),a(!0)}finally{j(!1)}};return e.jsx(J,{open:i,onClose:l,children:e.jsxs(N,{sx:Je,children:[e.jsx(U,{variant:"h6",fontWeight:"bold",mb:3,children:"Create New Test"}),e.jsxs(N,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(S,{label:"Test Name",name:"name",value:t.name,onChange:u,fullWidth:!0}),e.jsx(S,{label:"Description",name:"description",value:t.description,onChange:u,multiline:!0,rows:3,fullWidth:!0}),e.jsx(S,{label:"Duration (minutes)",name:"duration",type:"number",value:t.duration,onChange:u,fullWidth:!0}),e.jsxs(S,{select:!0,label:"Category",name:"category",value:t.category,onChange:u,fullWidth:!0,children:[e.jsx(z,{value:"Placements",children:"Placements"}),e.jsx(z,{value:"Gate",children:"Gate"})]}),e.jsx(A,{variant:"contained",color:"primary",onClick:g,disabled:o,sx:{backgroundColor:"#FF5C01",color:"#ffffff"},children:o?e.jsx(_,{size:20}):"Create Test"}),c&&e.jsx(U,{textAlign:"center",color:v?"error":"success.main",children:c})]})]})})};function Xe({open:i,setOpen:l}){const[s,t]=r.useState([]),[h,o]=r.useState(null);console.log(h);const[j,c]=r.useState(!1),[d,v]=r.useState(null),[a,u]=r.useState(0),[g,y]=r.useState(5),[x,M]=r.useState(""),[p,C]=r.useState(!1),[E,k]=r.useState({open:!1,message:"",severity:"success"}),ee=B(n=>n.auth.user)?.user._id,{id:se}=q(),te=B(K),ae=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,re=ge(),$=He(re.breakpoints.down("sm")),ne=async n=>{if(n.preventDefault(),s.length===0){v("Please add at least one valid email");return}if(s.filter(m=>m.role==="campus-admin").length>5){v("You can only invite up to 5 campus-admins at a time.");return}C(!0),k({open:!0,message:"Processing invites...",severity:"info"});try{const m=s.map(D=>({email:D.email,name:D.name||"Unknown",role:D.role,groupId:te,sectionId:se,invitedBy:ee})),I=await L.post(`${F}/api/campus/section/add`,{invites:m},{withCredentials:!0});o(I.data),t([]),v(null),k({open:!0,message:"Invites sent successfully!",severity:"success"})}catch(m){o({error:m.response?.data||m.message}),k({open:!0,message:m.response?.data?.message||"Failed to send invites.",severity:"error"})}finally{C(!1)}},oe=()=>{t(n=>[...n,{email:"",name:"",role:"user"}])},le=n=>{const f=n.target.files?.[0];if(!f)return;c(!0);const m=new FileReader;m.onload=I=>{const D=new Uint8Array(I.target?.result),O=Se(D,{type:"array"}),de=O.Sheets[O.SheetNames[0]],V=R.sheet_to_json(de).map(w=>({email:w.Email?.trim(),name:w.Name?.trim()||"Unknown",role:w.Role&&["user","campus-admin"].includes(w.Role)?w.Role:"user"})).filter(w=>w.email&&ae.test(w.email)&&!s.some(ue=>ue.email===w.email));V.length===0?v("No valid users found in file"):(t(w=>[...w,...V]),v(null)),c(!1)},m.readAsArrayBuffer(f)},ie=()=>{const n=[{Name:"John Doe",Email:"user1@example.com",Role:"user"},{Name:"Jane Smith",Email:"user2@example.com",Role:"campus-admin"}],f=R.json_to_sheet(n),m=R.book_new();R.book_append_sheet(m,f,"Users"),Ce(m,"sample_users.xlsx")},W=(n,f,m)=>{const I=[...s];I[n][f]=m,t(I)},ce=n=>{const f=[...s];f.splice(n,1),t(f)},Q=r.useMemo(()=>x?s.filter(n=>n.email.toLowerCase().includes(x.toLowerCase())||n.name.toLowerCase().includes(x.toLowerCase())):s,[x,s]);return e.jsxs(e.Fragment,{children:[e.jsx(we,{maxWidth:"xl",fullWidth:!0,open:i,onClose:()=>l(!1),fullScreen:$,PaperProps:{sx:{p:3,height:$?"100%":"90vh"}},children:e.jsxs(ze,{className:"flex flex-col gap-3",sx:{overflowY:"auto"},children:[e.jsx(U,{variant:"h5",mb:2,align:"center",children:"Add Members"}),e.jsx(G,{onClick:()=>l(!1),sx:{position:"absolute",right:5,top:3},children:e.jsx(Me,{})}),e.jsx(S,{size:"small",fullWidth:!0,placeholder:"Search by name or email",value:x,onChange:n=>M(n.target.value),sx:{mb:2}}),e.jsxs("form",{onSubmit:ne,className:"flex flex-col gap-3",children:[d&&e.jsx(ve,{error:!0,children:d}),e.jsxs(N,{display:"flex",gap:1,children:[e.jsxs(A,{variant:"outlined",size:"small",startIcon:e.jsx(Te,{}),component:"label",disabled:j,children:[j?e.jsx(_,{size:18}):"Upload",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.csv",onChange:le})]}),e.jsx(A,{variant:"outlined",size:"small",startIcon:e.jsx($e,{}),onClick:ie,children:"Sample"}),e.jsx(A,{variant:"outlined",size:"small",onClick:oe,children:"Add Row"})]}),e.jsxs(ke,{component:je,sx:{mt:2},children:[e.jsxs(Ne,{size:"small",children:[e.jsx(Ee,{children:e.jsxs(H,{children:[e.jsx(T,{children:"Email"}),e.jsx(T,{children:"Name"}),e.jsx(T,{children:"Role"}),e.jsx(T,{children:"Action"})]})}),e.jsx(Ie,{children:Q.length>0?Q.slice(a*g,a*g+g).map((n,f)=>e.jsxs(H,{children:[e.jsx(T,{children:e.jsx(S,{fullWidth:!0,size:"small",value:n.email,onChange:m=>W(a*g+f,"email",m.target.value)})}),e.jsx(T,{children:e.jsx(S,{size:"small",fullWidth:!0,value:n.name,onChange:m=>W(a*g+f,"name",m.target.value)})}),e.jsx(T,{children:e.jsxs(be,{fullWidth:!0,size:"small",value:n.role,onChange:m=>W(a*g+f,"role",m.target.value),children:[e.jsx(z,{value:"user",children:"User"}),e.jsx(z,{value:"campus-admin",children:"Campus Admin"})]})}),e.jsx(T,{children:e.jsx(G,{color:"error",onClick:()=>ce(a*g+f),children:e.jsx(Ae,{})})})]},f)):e.jsx(H,{children:e.jsx(T,{colSpan:4,align:"center",children:"No users added yet"})})})]}),Q.length>0&&e.jsx(Pe,{component:"div",count:Q.length,page:a,onPageChange:(n,f)=>u(f),rowsPerPage:g,onRowsPerPageChange:n=>{y(parseInt(n.target.value,10)),u(0)}})]}),e.jsx(A,{type:"submit",variant:"contained",fullWidth:!0,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:18,sx:{mr:1}}),"Processing..."]}):"Send Invites"})]})]})}),e.jsx(De,{open:E.open,autoHideDuration:3e3,onClose:()=>k(n=>({...n,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Qe,{onClose:()=>k(n=>({...n,open:!1})),severity:E.severity,variant:"filled",sx:{width:"100%"},children:E.message})})]})}const Ze=async({sectionId:i,groupId:l})=>l?(await L.get(`${F}/api/campus/insights/${i}/${l}`,{withCredentials:!0})).data:null,js=()=>{const[i,l]=r.useState(!1),[s,t]=r.useState(!1),{id:h}=q(),o=B(K)??"",[j,c]=r.useState(!1),[d,v]=r.useState("user"),{data:a,isLoading:u,isError:g,refetch:y}=ye({queryKey:["sectionInsights",h,o],queryFn:()=>Ze({sectionId:h,groupId:o}),enabled:!!h&&!!o,staleTime:1e3*60*5}),x=[{label:"Total Users",value:a?.totalUsers??0,icon:e.jsx(Oe,{className:"text-orange-600"})},{label:"Total Quizzes",value:a?.totalQuizzes??0,icon:e.jsx(Ve,{className:"text-orange-600"})},{label:"Quiz Submissions",value:a?.totalQuizSubmissions??0,icon:e.jsx(_e,{className:"text-orange-600"})},{label:"Total Tests",value:a?.totalTests??0,icon:e.jsx(Ge,{className:"text-orange-600"})},{label:"Test Submissions",value:a?.totalTestSubmissions??0,icon:e.jsx(Be,{className:"text-orange-600"})}],M=({onClick:p,label:C})=>e.jsxs("button",{onClick:p,className:"flex cursor-pointer items-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200",children:[e.jsx("span",{children:C}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]});return e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx(Xe,{role:d,open:j,setOpen:()=>c(!1)}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(M,{label:"Add Quiz",onClick:()=>l(!0)}),e.jsxs("div",{className:"relative group",children:[e.jsx(M,{label:"Add Members",onClick:()=>c(!0)}),e.jsxs("div",{className:"absolute hidden group-hover:flex flex-col bg-white border border-gray-200 rounded-lg shadow-lg top-full mt-2 right-0 z-10",children:[e.jsx("button",{className:"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",onClick:()=>{v("user"),c(!0)},children:"Add Students"}),e.jsx("button",{className:"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",onClick:()=>{v("campus-admin"),c(!0)},children:"Add Admins"})]})]})]}),u&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((p,C)=>e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse rounded-2xl"},C))}),g&&e.jsxs("div",{className:"text-red-600 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium",children:"Failed to fetch insights."}),e.jsx("button",{onClick:()=>y(),className:"underline text-sm hover:text-red-800",children:"Retry"})]}),!u&&!g&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:x.map((p,C)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md hover:shadow-lg transition-all duration-200 p-5 flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full mb-3",children:p.icon}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:p.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:p.value})]},C))}),e.jsx(qe,{open:i,onClose:()=>l(!1),sectionId:h}),e.jsx(Ke,{open:s,onClose:()=>t(!1),sectionId:h}),e.jsx(Re,{})]})};export{js as default};
