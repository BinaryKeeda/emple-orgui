import{ae as he,af as xe,r as n,ag as pe,_ as fe,c as R,j as e,ah as ge,ai as q,A as Y,M as B,H as k,I as y,aj as w,N as T,z as I,x as A,B as D,C as L,Q as V,ak as J,i as je,E as ve,G as be,K as G,al as se,am as ye,an as Ce,P as Se,ao as we,ap as ke,aq as K,ar as M,as as ze,at as Ee,aa as Ne,au as Me,a7 as Te,av as Qe,aw as Ie,y as Ae}from"./index-BrmEKs3f.js";import{r as De,u as F,w as Pe}from"./xlsx-DSqvgYLF.js";import{g as te}from"./userSelector-C6liUQHe.js";import{U as We}from"./UploadFile-Dfhe5_JT.js";import{D as Le}from"./Download-C_7m5zlo.js";import{S as Re}from"./StudentsTable-Bn4nGUxy.js";function Ue(c,l,s,t,x){const[r,p]=n.useState(()=>x&&s?s(c).matches:t?t(c).matches:l);return fe(()=>{if(!s)return;const i=s(c),o=()=>{p(i.matches)};return o(),i.addEventListener("change",o),()=>{i.removeEventListener("change",o)}},[c,s]),r}const Fe={...pe},ae=Fe.useSyncExternalStore;function qe(c,l,s,t,x){const r=n.useCallback(()=>l,[l]),p=n.useMemo(()=>{if(x&&s)return()=>s(c).matches;if(t!==null){const{matches:u}=t(c);return()=>u}return r},[r,c,t,x,s]),[i,o]=n.useMemo(()=>{if(s===null)return[r,()=>()=>{}];const u=s(c);return[()=>u.matches,m=>(u.addEventListener("change",m),()=>{u.removeEventListener("change",m)})]},[r,s,c]);return ae(o,i,p)}function ne(c={}){const{themeId:l}=c;return function(t,x={}){let r=he();r&&l&&(r=r[l]||r);const p=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:i=!1,matchMedia:o=p?window.matchMedia:null,ssrMatchMedia:d=null,noSsr:u=!1}=xe({name:"MuiUseMediaQuery",props:x,theme:r});let m=typeof t=="function"?t(r):t;return m=m.replace(/^@media( ?)/m,""),m.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(ae!==void 0?qe:Ue)(m,i,o,d,u)}}ne();const Be=R(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),_e=R(e.jsx("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"})),$e=R(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),He=R([e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-5.99 13c-.59 0-1.05-.47-1.05-1.05 0-.59.47-1.04 1.05-1.04.59 0 1.04.45 1.04 1.04-.01.58-.45 1.05-1.04 1.05m2.5-6.17c-.63.93-1.23 1.21-1.56 1.81-.13.24-.18.4-.18 1.18h-1.52c0-.41-.06-1.08.26-1.65.41-.73 1.18-1.16 1.63-1.8.48-.68.21-1.94-1.14-1.94-.88 0-1.32.67-1.5 1.23l-1.37-.57C11.51 5.96 12.52 5 13.99 5c1.23 0 2.08.56 2.51 1.26.37.61.58 1.73.01 2.57"},"1")]),Oe=R(e.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"})),Ke=ne({themeId:ge}),Ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Ge=({open:c,onClose:l,sectionId:s})=>{const[t,x]=n.useState(""),[r,p]=n.useState(0),[i,o]=n.useState(30),[d,u]=n.useState("Core"),[m,a]=n.useState("Medium"),[b,f]=n.useState(""),[P,C]=n.useState(!1),[z,E]=n.useState(!1),N=q(),{enqueueSnackbar:_}=Y(),$=async()=>{if(!t.trim()){f("Quiz title is required"),C(!0);return}if(r<=0){f("Marks must be greater than 0"),C(!0);return}if(i<=0){f("Duration must be greater than 0"),C(!0);return}E(!0),f(""),C(!1);try{const v=await A.post(`${D}/api/campus/create/quiz/${s}`,{title:t,marks:r,duration:i,category:d,difficulty:m,sectionId:s},{withCredentials:!0});v.data.success?(N.invalidateQueries({queryKey:["quizzes",s]}),_("Quiz created successfully!",{variant:"success"}),C(!1),l(),x(""),p(0),o(30),u("Core"),a("Medium")):(f(v.data.message||"Failed to create quiz"),C(!0))}catch(v){console.error(v),f(v?.response?.data?.message||"Internal Server Error"),C(!0)}finally{E(!1)}};return e.jsx(B,{open:c,onClose:l,children:e.jsx(k,{sx:Ve,children:e.jsxs(k,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(y,{label:"Quiz Title",value:t,onChange:v=>x(v.target.value),fullWidth:!0}),e.jsxs(k,{display:"flex",gap:2,children:[e.jsx(y,{label:"Marks",type:"number",value:r,onChange:v=>p(Number(v.target.value)),fullWidth:!0}),e.jsx(y,{label:"Duration (minutes)",type:"number",value:i,onChange:v=>o(Number(v.target.value)),fullWidth:!0})]}),e.jsxs(k,{display:"flex",gap:2,children:[e.jsxs(y,{select:!0,label:"Category",value:d,onChange:v=>u(v.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Core",children:"Core"}),e.jsx(w,{value:"Aptitude",children:"Aptitude"}),e.jsx(w,{value:"Miscellaneous",children:"Misc"})]}),e.jsxs(y,{select:!0,label:"Difficulty",value:m,onChange:v=>a(v.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Easy",children:"Easy"}),e.jsx(w,{value:"Medium",children:"Medium"}),e.jsx(w,{value:"Hard",children:"Hard"})]})]}),e.jsx(T,{sx:{backgroundColor:"#FF5C01",color:"#ffffff"},variant:"contained",color:"primary",onClick:$,disabled:z,children:z?"Creating...":"Create Quiz"}),b&&e.jsx(I,{textAlign:"center",color:P?"error":"success.main",children:b})]})})})},Ye={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Je={name:"",description:"",duration:30,visibility:"private",category:"Placements"},Xe=({open:c,onClose:l,sectionId:s})=>{const[t,x]=n.useState(Je),[r,p]=n.useState(!1),{enqueueSnackbar:i}=Y(),o=q(),d=m=>{const{name:a,value:b}=m.target;x(f=>({...f,[a]:a==="duration"?Number(b):b}))},u=async()=>{if(!t.name.trim()){i("Test name is required",{variant:"error"});return}if(t.duration<=0){i("Duration must be greater than 0",{variant:"error"});return}p(!0);try{await A.post(`${D}/api/campus/create/test/${s}`,t,{withCredentials:!0}),i("Test created successfully!",{variant:"success"}),await o.invalidateQueries({queryKey:["exam"]}),l()}catch(m){console.error(m),i(m?.response?.data?.error||"Internal Server Error",{variant:"error"})}finally{p(!1)}};return e.jsx(B,{open:c,onClose:l,children:e.jsxs(k,{sx:Ye,children:[e.jsx(I,{variant:"h6",fontWeight:"bold",mb:3,children:"Create New Test"}),e.jsxs(k,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(y,{label:"Test Name",name:"name",value:t.name,onChange:d,fullWidth:!0}),e.jsx(y,{label:"Description",name:"description",value:t.description,onChange:d,multiline:!0,rows:3,fullWidth:!0}),e.jsx(y,{label:"Duration (minutes)",name:"duration",type:"number",value:t.duration,onChange:d,fullWidth:!0}),e.jsxs(y,{select:!0,label:"Category",name:"category",value:t.category,onChange:d,fullWidth:!0,children:[e.jsx(w,{value:"Placements",children:"Placements"}),e.jsx(w,{value:"Gate",children:"Gate"})]}),e.jsx(T,{variant:"contained",color:"primary",onClick:u,disabled:r,sx:{backgroundColor:"#FF5C01",color:"#ffffff"},children:r?e.jsx(L,{size:20}):"Create Test"})]})]})})};function Ze({open:c,setOpen:l}){const[s,t]=n.useState([]),[x,r]=n.useState(null);console.log(x);const[p,i]=n.useState(!1),[o,d]=n.useState(null),[u,m]=n.useState(0),[a,b]=n.useState(5),[f,P]=n.useState(""),[C,z]=n.useState(!1),N=V(h=>h.auth.user)?.user._id,{id:_}=J(),$=V(te),v=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,{enqueueSnackbar:H}=Y(),re=je(),X=Ke(re.breakpoints.down("sm")),le=async h=>{if(h.preventDefault(),s.length===0){d("Please add at least one valid email");return}if(s.filter(g=>g.role==="campus-admin").length>5){d("You can only invite up to 5 campus-admins at a time.");return}z(!0),H("Processing invites...",{variant:"info"});try{const g=s.map(W=>({email:W.email,name:W.name||"Unknown",role:W.role,groupId:$,sectionId:_,invitedBy:N})),Q=await A.post(`${D}/api/campus/section/add`,{invites:g},{withCredentials:!0});r(Q.data),t([]),d(null),H("Invite send successfully",{variant:"success"}),l(!1)}catch(g){r({error:g.response?.data||g.message}),H("Error sending",{variant:"success"})}finally{z(!1)}},ie=()=>{t(h=>[...h,{email:"",name:"",role:"user"}])},oe=h=>{const j=h.target.files?.[0];if(!j)return;i(!0);const g=new FileReader;g.onload=Q=>{const W=new Uint8Array(Q.target?.result),Z=De(W,{type:"array"}),de=Z.Sheets[Z.SheetNames[0]],ee=F.sheet_to_json(de).map(S=>({email:S.Email?.trim(),name:S.Name?.trim()||"Unknown",role:S.Role&&["user","campus-admin"].includes(S.Role)?S.Role:"user"})).filter(S=>S.email&&v.test(S.email)&&!s.some(me=>me.email===S.email));ee.length===0?d("No valid users found in file"):(t(S=>[...S,...ee]),d(null)),i(!1)},g.readAsArrayBuffer(j)},ce=()=>{const h=[{Name:"John Doe",Email:"user1@example.com",Role:"user"},{Name:"Jane Smith",Email:"user2@example.com",Role:"campus-admin"}],j=F.json_to_sheet(h),g=F.book_new();F.book_append_sheet(g,j,"Users"),Pe(g,"sample_users.xlsx")},O=(h,j,g)=>{const Q=[...s];Q[h][j]=g,t(Q)},ue=h=>{const j=[...s];j.splice(h,1),t(j)},U=n.useMemo(()=>f?s.filter(h=>h.email.toLowerCase().includes(f.toLowerCase())||h.name.toLowerCase().includes(f.toLowerCase())):s,[f,s]);return e.jsx(e.Fragment,{children:e.jsx(ve,{maxWidth:"xl",fullWidth:!0,open:c,onClose:()=>l(!1),fullScreen:X,PaperProps:{sx:{p:3,height:X?"100%":"90vh"}},children:e.jsxs(be,{className:"flex flex-col gap-3",sx:{overflowY:"auto"},children:[e.jsx(I,{variant:"h5",mb:2,align:"center",children:"Add Members"}),e.jsx(G,{onClick:()=>l(!1),sx:{position:"absolute",right:5,top:3},children:e.jsx(se,{})}),e.jsx(y,{size:"small",fullWidth:!0,placeholder:"Search by name or email",value:f,onChange:h=>P(h.target.value),sx:{mb:2}}),e.jsxs("form",{onSubmit:le,className:"flex flex-col gap-3",children:[o&&e.jsx(ye,{error:!0,children:o}),e.jsxs(k,{display:"flex",gap:1,children:[e.jsxs(T,{variant:"outlined",size:"small",startIcon:e.jsx(We,{}),component:"label",disabled:p,children:[p?e.jsx(L,{size:18}):"Upload",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.csv",onChange:oe})]}),e.jsx(T,{variant:"outlined",size:"small",startIcon:e.jsx(Le,{}),onClick:ce,children:"Sample"}),e.jsx(T,{variant:"outlined",size:"small",onClick:ie,children:"Add +"})]}),e.jsxs(Ce,{component:Se,sx:{mt:2},children:[e.jsxs(we,{size:"small",children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(M,{children:"Email"}),e.jsx(M,{children:"Name"}),e.jsx(M,{children:"Role"}),e.jsx(M,{children:"Action"})]})}),e.jsx(ze,{children:U.length>0?U.slice(u*a,u*a+a).map((h,j)=>e.jsxs(K,{children:[e.jsx(M,{children:e.jsx(y,{fullWidth:!0,size:"small",value:h.email,onChange:g=>O(u*a+j,"email",g.target.value)})}),e.jsx(M,{children:e.jsx(y,{size:"small",fullWidth:!0,value:h.name,onChange:g=>O(u*a+j,"name",g.target.value)})}),e.jsx(M,{children:e.jsxs(Ee,{fullWidth:!0,size:"small",value:h.role,onChange:g=>O(u*a+j,"role",g.target.value),children:[e.jsx(w,{value:"user",children:"User"}),e.jsx(w,{value:"campus-admin",children:"Campus Admin"})]})}),e.jsx(M,{children:e.jsx(G,{color:"error",onClick:()=>ue(u*a+j),children:e.jsx(Ne,{})})})]},j)):e.jsx(K,{children:e.jsx(M,{colSpan:4,align:"center",children:"No users added yet"})})})]}),U.length>0&&e.jsx(Me,{component:"div",count:U.length,page:u,onPageChange:(h,j)=>m(j),rowsPerPage:a,onRowsPerPageChange:h=>{b(parseInt(h.target.value,10)),m(0)}})]}),e.jsx(T,{type:"submit",variant:"contained",fullWidth:!0,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:18,sx:{mr:1}}),"Processing..."]}):"Send Invites"})]})]})})})}const es=({sectionId:c,open:l,onClose:s,onSuccess:t})=>{const[x,r]=n.useState({name:"",sectionId:c,visibility:"public"}),p=q(),[i,o]=n.useState(!1),[d,u]=n.useState(null),m=b=>{r({...x,[b.target.name]:b.target.value})},a=async b=>{b.preventDefault(),o(!0),u(null);try{(await A.post(`${D}/api/exam/create`,x)).data.success&&(t?.(),r({name:"",sectionId:c,visibility:"public"}),p.invalidateQueries({queryKey:["exam"]}),s())}catch(f){u(f.response?.data?.message||"Error creating exam")}finally{o(!1)}};return e.jsx(B,{open:l,onClose:s,closeAfterTransition:!0,slots:{backdrop:Te},slotProps:{backdrop:{timeout:300}},children:e.jsx(Qe,{in:l,children:e.jsxs(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:3,boxShadow:24,p:4,width:"90%",maxWidth:450},children:[e.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(I,{variant:"h6",fontWeight:"bold",children:"Create New Exam"}),e.jsx(G,{onClick:s,size:"small",children:e.jsx(se,{})})]}),e.jsxs(k,{component:"form",onSubmit:a,sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(y,{label:"Exam Name",name:"name",value:x.name,onChange:m,required:!0,fullWidth:!0}),d&&e.jsx(I,{color:"error",variant:"body2",children:d}),e.jsx(T,{type:"submit",variant:"contained",disabled:i,fullWidth:!0,sx:{mt:1},children:i?e.jsx(L,{size:24}):"Create Exam"})]})]})})})},ss=["Core","Aptitude","Excel","Miscellaneous"],ts=({open:c,onClose:l,onSuccess:s})=>{const{id:t}=J(),[x,r]=n.useState(""),[p,i]=n.useState(""),[o,d]=n.useState(!1),u=q(),m=async()=>{if(!x||!p){alert("Please fill in all fields");return}try{d(!0),await A.post(`${D}/api/exam/create/bank`,{name:x,category:p,sectionId:t}),r(""),i(""),u.invalidateQueries({queryKey:["questions"]}),s&&s(),l()}catch(a){console.error(a),alert(a.response?.data?.message||"Failed to create bank")}finally{d(!1)}};return e.jsx(B,{open:c,onClose:l,children:e.jsxs(k,{sx:{backgroundColor:"background.paper",borderRadius:3,boxShadow:5,p:4,width:400,mx:"auto",mt:"15vh",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(I,{variant:"h6",fontWeight:"600",textAlign:"center",children:"Create Question Bank"}),e.jsx(y,{label:"Bank Name",variant:"outlined",fullWidth:!0,value:x,onChange:a=>r(a.target.value)}),e.jsx(y,{select:!0,label:"Category",value:p,onChange:a=>i(a.target.value),fullWidth:!0,children:ss.map(a=>e.jsx(w,{value:a,children:a},a))}),e.jsxs(Ie,{direction:"row",justifyContent:"flex-end",spacing:2,mt:2,children:[e.jsx(T,{onClick:l,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(T,{onClick:m,variant:"contained",color:"primary",disabled:o,children:o?e.jsx(L,{size:22,color:"inherit"}):"Create"})]})]})})},as=async({sectionId:c,groupId:l})=>l?(await A.get(`${D}/api/campus/insights/${c}/${l}`,{withCredentials:!0})).data:null,ds=()=>{const[c,l]=n.useState(!1),[s,t]=n.useState(!1),[x,r]=n.useState(!1),[p,i]=n.useState(!1),{id:o}=J(),d=V(te)??"",[u,m]=n.useState(!1),{data:a,isLoading:b,isError:f,refetch:P}=Ae({queryKey:["sectionInsights",o,d],queryFn:()=>as({sectionId:o,groupId:d}),enabled:!!o&&!!d,staleTime:1e3*60*5}),C=[{label:"Total Users",value:a?.totalUsers??0,icon:e.jsx($e,{className:"text-orange-600"})},{label:"Total Quizzes",value:a?.totalQuizzes??0,icon:e.jsx(He,{className:"text-orange-600"})},{label:"Quiz Submissions",value:a?.totalQuizSubmissions??0,icon:e.jsx(Be,{className:"text-orange-600"})},{label:"Total Tests",value:a?.totalTests??0,icon:e.jsx(Oe,{className:"text-orange-600"})},{label:"Test Submissions",value:a?.totalTestSubmissions??0,icon:e.jsx(_e,{className:"text-orange-600"})}],z=({onClick:E,label:N})=>e.jsxs("button",{onClick:E,className:"flex cursor-pointer items-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200",children:[e.jsx("span",{children:N}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]});return e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx(Ze,{open:u,setOpen:()=>m(!1)}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(z,{label:"Add Quiz",onClick:()=>l(!0)}),e.jsx(z,{label:"Add Exam",onClick:()=>r(!0)}),e.jsx(z,{label:"Add Bank",onClick:()=>i(!0)}),e.jsx("div",{className:"relative group",children:e.jsx(z,{label:"Add Members",onClick:()=>m(!0)})})]}),b&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((E,N)=>e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse rounded-2xl"},N))}),f&&e.jsxs("div",{className:"text-red-600 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium",children:"Failed to fetch insights."}),e.jsx("button",{onClick:()=>P(),className:"underline text-sm hover:text-red-800",children:"Retry"})]}),!b&&!f&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:C.map((E,N)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md hover:shadow-lg transition-all duration-200 p-5 flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full mb-3",children:E.icon}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:E.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:E.value})]},N))}),e.jsx(Ge,{open:c,onClose:()=>l(!1),sectionId:o}),e.jsx(Xe,{open:s,onClose:()=>t(!1),sectionId:o}),e.jsx(ts,{open:p,onClose:()=>i(!1)}),e.jsx(es,{sectionId:o,open:x,onClose:()=>r(!1)}),e.jsx(Re,{})]})};export{ds as default};
