import{ab as me,ac as he,r as a,ad as xe,X as pe,ae as ge,w as P,j as e,M as V,S as N,a5 as b,af as y,R as T,z as I,x as Q,B as W,E as K,C as R,F as $,ag as O,h as fe,J as ve,N as je,I as Y,ah as be,ai as ye,P as Ce,aj as Se,ak as we,al as _,am as E,an as ke,ao as X,a8 as Me,ap as ze,aq as Ee,ar as Ne,as as Te,at as Ae,au as Ie,y as De}from"./index-CUL5stip.js";import{r as Pe,u as F,w as Qe}from"./xlsx-DSqvgYLF.js";import{g as Z}from"./userSelector-C6liUQHe.js";import{C as We,U as Le}from"./UploadFile-tEJfOprR.js";import{S as Re}from"./StudentsTable-C9zOz92S.js";function Ue(c,o,s,t,g){const[n,h]=a.useState(()=>g&&s?s(c).matches:t?t(c).matches:o);return pe(()=>{if(!s)return;const d=s(c),l=()=>{h(d.matches)};return l(),d.addEventListener("change",l),()=>{d.removeEventListener("change",l)}},[c,s]),n}const Fe={...xe},ee=Fe.useSyncExternalStore;function Be(c,o,s,t,g){const n=a.useCallback(()=>o,[o]),h=a.useMemo(()=>{if(g&&s)return()=>s(c).matches;if(t!==null){const{matches:i}=t(c);return()=>i}return n},[n,c,t,g,s]),[d,l]=a.useMemo(()=>{if(s===null)return[n,()=>()=>{}];const i=s(c);return[()=>i.matches,r=>(i.addEventListener("change",r),()=>{i.removeEventListener("change",r)})]},[n,s,c]);return ee(l,d,h)}function se(c={}){const{themeId:o}=c;return function(t,g={}){let n=me();n&&o&&(n=n[o]||n);const h=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:d=!1,matchMedia:l=h?window.matchMedia:null,ssrMatchMedia:x=null,noSsr:i=!1}=he({name:"MuiUseMediaQuery",props:g,theme:n});let r=typeof t=="function"?t(n):t;return r=r.replace(/^@media( ?)/m,""),r.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(ee!==void 0?Be:Ue)(r,d,l,x,i)}}se();const He=se({themeId:ge}),_e=P(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),$e=P(e.jsx("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"})),Ve=P(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),Oe=P(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),qe=P([e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-5.99 13c-.59 0-1.05-.47-1.05-1.05 0-.59.47-1.04 1.05-1.04.59 0 1.04.45 1.04 1.04-.01.58-.45 1.05-1.04 1.05m2.5-6.17c-.63.93-1.23 1.21-1.56 1.81-.13.24-.18.4-.18 1.18h-1.52c0-.41-.06-1.08.26-1.65.41-.73 1.18-1.16 1.63-1.8.48-.68.21-1.94-1.14-1.94-.88 0-1.32.67-1.5 1.23l-1.37-.57C11.51 5.96 12.52 5 13.99 5c1.23 0 2.08.56 2.51 1.26.37.61.58 1.73.01 2.57"},"1")]),Ge=P(e.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"})),Je={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Ye=({open:c,onClose:o,sectionId:s})=>{const[t,g]=a.useState(""),[n,h]=a.useState(0),[d,l]=a.useState(30),[x,i]=a.useState("Core"),[r,p]=a.useState("Medium"),[C,u]=a.useState(""),[A,S]=a.useState(!1),[k,M]=a.useState(!1),z=async()=>{if(!t.trim()){u("Quiz title is required"),S(!0);return}if(n<=0){u("Marks must be greater than 0"),S(!0);return}if(d<=0){u("Duration must be greater than 0"),S(!0);return}M(!0),u(""),S(!1);try{const j=await Q.post(`${W}/api/campus/create/quiz/${s}`,{title:t,marks:n,duration:d,category:x,difficulty:r,sectionId:s},{withCredentials:!0});j.data.success?(u("Quiz created successfully!"),S(!1),g(""),h(0),l(30),i("Core"),p("Medium")):(u(j.data.message||"Failed to create quiz"),S(!0))}catch(j){console.error(j),u(j?.response?.data?.message||"Internal Server Error"),S(!0)}finally{M(!1)}};return e.jsx(V,{open:c,onClose:o,children:e.jsx(N,{sx:Je,children:e.jsxs(N,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Quiz Title",value:t,onChange:j=>g(j.target.value),fullWidth:!0}),e.jsxs(N,{display:"flex",gap:2,children:[e.jsx(b,{label:"Marks",type:"number",value:n,onChange:j=>h(Number(j.target.value)),fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",type:"number",value:d,onChange:j=>l(Number(j.target.value)),fullWidth:!0})]}),e.jsxs(N,{display:"flex",gap:2,children:[e.jsxs(b,{select:!0,label:"Category",value:x,onChange:j=>i(j.target.value),fullWidth:!0,children:[e.jsx(y,{value:"Core",children:"Core"}),e.jsx(y,{value:"Aptitude",children:"Aptitude"}),e.jsx(y,{value:"Miscellaneous",children:"Misc"})]}),e.jsxs(b,{select:!0,label:"Difficulty",value:r,onChange:j=>p(j.target.value),fullWidth:!0,children:[e.jsx(y,{value:"Easy",children:"Easy"}),e.jsx(y,{value:"Medium",children:"Medium"}),e.jsx(y,{value:"Hard",children:"Hard"})]})]}),e.jsx(T,{sx:{backgroundColor:"#FF5C01",color:"#ffffff"},variant:"contained",color:"primary",onClick:z,disabled:k,children:k?"Creating...":"Create Quiz"}),C&&e.jsx(I,{textAlign:"center",color:A?"error":"success.main",children:C})]})})})},Ke={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Xe={name:"",description:"",duration:30,visibility:"private",category:"Placements"},Ze=({open:c,onClose:o,sectionId:s})=>{const[t,g]=a.useState(Xe),[n,h]=a.useState(!1),{enqueueSnackbar:d}=K(),l=i=>{const{name:r,value:p}=i.target;g(C=>({...C,[r]:r==="duration"?Number(p):p}))},x=async()=>{if(!t.name.trim()){d("Test name is required",{variant:"error"});return}if(t.duration<=0){d("Duration must be greater than 0",{variant:"error"});return}h(!0);try{await Q.post(`${W}/api/campus/create/test/${s}`,t,{withCredentials:!0}),d("âœ… Test created successfully!",{variant:"success"}),o()}catch(i){console.error(i),d(i?.response?.data?.error||"Internal Server Error",{variant:"error"})}finally{h(!1)}};return e.jsx(V,{open:c,onClose:o,children:e.jsxs(N,{sx:Ke,children:[e.jsx(I,{variant:"h6",fontWeight:"bold",mb:3,children:"Create New Test"}),e.jsxs(N,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Test Name",name:"name",value:t.name,onChange:l,fullWidth:!0}),e.jsx(b,{label:"Description",name:"description",value:t.description,onChange:l,multiline:!0,rows:3,fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",name:"duration",type:"number",value:t.duration,onChange:l,fullWidth:!0}),e.jsxs(b,{select:!0,label:"Category",name:"category",value:t.category,onChange:l,fullWidth:!0,children:[e.jsx(y,{value:"Placements",children:"Placements"}),e.jsx(y,{value:"Gate",children:"Gate"})]}),e.jsx(T,{variant:"contained",color:"primary",onClick:x,disabled:n,sx:{backgroundColor:"#FF5C01",color:"#ffffff"},children:n?e.jsx(R,{size:20}):"Create Test"})]})]})})};function es({open:c,setOpen:o}){const[s,t]=a.useState([]),[g,n]=a.useState(null);console.log(g);const[h,d]=a.useState(!1),[l,x]=a.useState(null),[i,r]=a.useState(0),[p,C]=a.useState(5),[u,A]=a.useState(""),[S,k]=a.useState(!1),z=$(m=>m.auth.user)?.user._id,{id:j}=O(),te=$(Z),ae=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,{enqueueSnackbar:B}=K(),ne=fe(),q=He(ne.breakpoints.down("sm")),re=async m=>{if(m.preventDefault(),s.length===0){x("Please add at least one valid email");return}if(s.filter(f=>f.role==="campus-admin").length>5){x("You can only invite up to 5 campus-admins at a time.");return}k(!0),B("Processing invites...",{variant:"info"});try{const f=s.map(L=>({email:L.email,name:L.name||"Unknown",role:L.role,groupId:te,sectionId:j,invitedBy:z})),D=await Q.post(`${W}/api/campus/section/add`,{invites:f},{withCredentials:!0});n(D.data),t([]),x(null),B("Invite send successfully",{variant:"success"}),o(!1)}catch(f){n({error:f.response?.data||f.message}),B("Error sending",{variant:"success"})}finally{k(!1)}},le=()=>{t(m=>[...m,{email:"",name:"",role:"user"}])},ie=m=>{const v=m.target.files?.[0];if(!v)return;d(!0);const f=new FileReader;f.onload=D=>{const L=new Uint8Array(D.target?.result),G=Pe(L,{type:"array"}),de=G.Sheets[G.SheetNames[0]],J=F.sheet_to_json(de).map(w=>({email:w.Email?.trim(),name:w.Name?.trim()||"Unknown",role:w.Role&&["user","campus-admin"].includes(w.Role)?w.Role:"user"})).filter(w=>w.email&&ae.test(w.email)&&!s.some(ue=>ue.email===w.email));J.length===0?x("No valid users found in file"):(t(w=>[...w,...J]),x(null)),d(!1)},f.readAsArrayBuffer(v)},oe=()=>{const m=[{Name:"John Doe",Email:"user1@example.com",Role:"user"},{Name:"Jane Smith",Email:"user2@example.com",Role:"campus-admin"}],v=F.json_to_sheet(m),f=F.book_new();F.book_append_sheet(f,v,"Users"),Qe(f,"sample_users.xlsx")},H=(m,v,f)=>{const D=[...s];D[m][v]=f,t(D)},ce=m=>{const v=[...s];v.splice(m,1),t(v)},U=a.useMemo(()=>u?s.filter(m=>m.email.toLowerCase().includes(u.toLowerCase())||m.name.toLowerCase().includes(u.toLowerCase())):s,[u,s]);return e.jsx(e.Fragment,{children:e.jsx(ve,{maxWidth:"xl",fullWidth:!0,open:c,onClose:()=>o(!1),fullScreen:q,PaperProps:{sx:{p:3,height:q?"100%":"90vh"}},children:e.jsxs(je,{className:"flex flex-col gap-3",sx:{overflowY:"auto"},children:[e.jsx(I,{variant:"h5",mb:2,align:"center",children:"Add Members"}),e.jsx(Y,{onClick:()=>o(!1),sx:{position:"absolute",right:5,top:3},children:e.jsx(We,{})}),e.jsx(b,{size:"small",fullWidth:!0,placeholder:"Search by name or email",value:u,onChange:m=>A(m.target.value),sx:{mb:2}}),e.jsxs("form",{onSubmit:re,className:"flex flex-col gap-3",children:[l&&e.jsx(be,{error:!0,children:l}),e.jsxs(N,{display:"flex",gap:1,children:[e.jsxs(T,{variant:"outlined",size:"small",startIcon:e.jsx(Le,{}),component:"label",disabled:h,children:[h?e.jsx(R,{size:18}):"Upload",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.csv",onChange:ie})]}),e.jsx(T,{variant:"outlined",size:"small",startIcon:e.jsx(Ve,{}),onClick:oe,children:"Sample"}),e.jsx(T,{variant:"outlined",size:"small",onClick:le,children:"Add +"})]}),e.jsxs(ye,{component:Ce,sx:{mt:2},children:[e.jsxs(Se,{size:"small",children:[e.jsx(we,{children:e.jsxs(_,{children:[e.jsx(E,{children:"Email"}),e.jsx(E,{children:"Name"}),e.jsx(E,{children:"Role"}),e.jsx(E,{children:"Action"})]})}),e.jsx(ke,{children:U.length>0?U.slice(i*p,i*p+p).map((m,v)=>e.jsxs(_,{children:[e.jsx(E,{children:e.jsx(b,{fullWidth:!0,size:"small",value:m.email,onChange:f=>H(i*p+v,"email",f.target.value)})}),e.jsx(E,{children:e.jsx(b,{size:"small",fullWidth:!0,value:m.name,onChange:f=>H(i*p+v,"name",f.target.value)})}),e.jsx(E,{children:e.jsxs(X,{fullWidth:!0,size:"small",value:m.role,onChange:f=>H(i*p+v,"role",f.target.value),children:[e.jsx(y,{value:"user",children:"User"}),e.jsx(y,{value:"campus-admin",children:"Campus Admin"})]})}),e.jsx(E,{children:e.jsx(Y,{color:"error",onClick:()=>ce(i*p+v),children:e.jsx(Me,{})})})]},v)):e.jsx(_,{children:e.jsx(E,{colSpan:4,align:"center",children:"No users added yet"})})})]}),U.length>0&&e.jsx(ze,{component:"div",count:U.length,page:i,onPageChange:(m,v)=>r(v),rowsPerPage:p,onRowsPerPageChange:m=>{C(parseInt(m.target.value,10)),r(0)}})]}),e.jsx(T,{type:"submit",variant:"contained",fullWidth:!0,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:18,sx:{mr:1}}),"Processing..."]}):"Send Invites"})]})]})})})}const ss=({sectionId:c,onSuccess:o})=>{const[s,t]=a.useState({name:"",isAvailable:!0,sectionId:c,visibility:"public"}),[g,n]=a.useState(!1),[h,d]=a.useState(null),[l,x]=a.useState(null),i=u=>{t({...s,[u.target.name]:u.target.value})},r=u=>{t({...s,visibility:u.target.value})},p=u=>{t({...s,isAvailable:u.target.checked})},C=async u=>{u.preventDefault(),n(!0),d(null),x(null);try{(await Q.post(`${W}/api/exam/create`,s)).data.success&&(x("Exam created successfully!"),o?.(),t({name:"",isAvailable:!0,sectionId:c,visibility:"public"}))}catch(A){d(A.response?.data?.message||"Error creating exam")}finally{n(!1)}};return e.jsxs(N,{component:"form",onSubmit:C,sx:{display:"flex",flexDirection:"column",gap:2,width:"100%",maxWidth:400},children:[e.jsx(I,{variant:"h6",fontWeight:"bold",children:"Create New Exam"}),e.jsx(b,{label:"Exam Name",name:"name",value:s.name,onChange:i,required:!0,fullWidth:!0}),e.jsxs(Ee,{fullWidth:!0,children:[e.jsx(Ne,{children:"Visibility"}),e.jsxs(X,{value:s.visibility,label:"Visibility",onChange:r,children:[e.jsx(y,{value:"public",children:"Public"}),e.jsx(y,{value:"private",children:"Private"}),e.jsx(y,{value:"restricted",children:"Restricted"})]})]}),e.jsx(Te,{control:e.jsx(Ae,{checked:s.isAvailable,onChange:p,name:"isAvailable"}),label:"Available"}),h&&e.jsx(I,{color:"error",variant:"body2",children:h}),l&&e.jsx(I,{color:"success.main",variant:"body2",children:l}),e.jsx(T,{type:"submit",variant:"contained",disabled:g,fullWidth:!0,sx:{mt:1},children:g?e.jsx(R,{size:24}):"Create Exam"})]})},ts=["Core","Aptitude","Excel","Miscellaneous"],as=({open:c,onClose:o,onSuccess:s})=>{const{id:t}=O(),[g,n]=a.useState(""),[h,d]=a.useState(""),[l,x]=a.useState(!1),i=async()=>{if(!g||!h){alert("Please fill in all fields");return}try{x(!0),await Q.post(`${W}/api/exam/create/bank`,{name:g,category:h,sectionId:t}),n(""),d(""),s&&s(),o()}catch(r){console.error(r),alert(r.response?.data?.message||"Failed to create bank")}finally{x(!1)}};return e.jsx(V,{open:c,onClose:o,children:e.jsxs(N,{sx:{backgroundColor:"background.paper",borderRadius:3,boxShadow:5,p:4,width:400,mx:"auto",mt:"15vh",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(I,{variant:"h6",fontWeight:"600",textAlign:"center",children:"Create Question Bank"}),e.jsx(b,{label:"Bank Name",variant:"outlined",fullWidth:!0,value:g,onChange:r=>n(r.target.value)}),e.jsx(b,{select:!0,label:"Category",value:h,onChange:r=>d(r.target.value),fullWidth:!0,children:ts.map(r=>e.jsx(y,{value:r,children:r},r))}),e.jsxs(Ie,{direction:"row",justifyContent:"flex-end",spacing:2,mt:2,children:[e.jsx(T,{onClick:o,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(T,{onClick:i,variant:"contained",color:"primary",disabled:l,children:l?e.jsx(R,{size:22,color:"inherit"}):"Create"})]})]})})},ns=async({sectionId:c,groupId:o})=>o?(await Q.get(`${W}/api/campus/insights/${c}/${o}`,{withCredentials:!0})).data:null,us=()=>{const[c,o]=a.useState(!1),[s,t]=a.useState(!1),[g,n]=a.useState(!1),[h,d]=a.useState(!1),{id:l}=O(),x=$(Z)??"",[i,r]=a.useState(!1),{data:p,isLoading:C,isError:u,refetch:A}=De({queryKey:["sectionInsights",l,x],queryFn:()=>ns({sectionId:l,groupId:x}),enabled:!!l&&!!x,staleTime:1e3*60*5}),S=[{label:"Total Users",value:p?.totalUsers??0,icon:e.jsx(Oe,{className:"text-orange-600"})},{label:"Total Quizzes",value:p?.totalQuizzes??0,icon:e.jsx(qe,{className:"text-orange-600"})},{label:"Quiz Submissions",value:p?.totalQuizSubmissions??0,icon:e.jsx(_e,{className:"text-orange-600"})},{label:"Total Tests",value:p?.totalTests??0,icon:e.jsx(Ge,{className:"text-orange-600"})},{label:"Test Submissions",value:p?.totalTestSubmissions??0,icon:e.jsx($e,{className:"text-orange-600"})}],k=({onClick:M,label:z})=>e.jsxs("button",{onClick:M,className:"flex cursor-pointer items-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200",children:[e.jsx("span",{children:z}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]});return e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx(es,{open:i,setOpen:()=>r(!1)}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(k,{label:"Add Quiz",onClick:()=>o(!0)}),e.jsx(k,{label:"Add Exam",onClick:()=>n(!0)}),e.jsx(k,{label:"Add Bank",onClick:()=>n(!0)}),e.jsx("div",{className:"relative group",children:e.jsx(k,{label:"Add Members",onClick:()=>r(!0)})})]}),C&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((M,z)=>e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse rounded-2xl"},z))}),u&&e.jsxs("div",{className:"text-red-600 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium",children:"Failed to fetch insights."}),e.jsx("button",{onClick:()=>A(),className:"underline text-sm hover:text-red-800",children:"Retry"})]}),!C&&!u&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:S.map((M,z)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md hover:shadow-lg transition-all duration-200 p-5 flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full mb-3",children:M.icon}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:M.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:M.value})]},z))}),e.jsx(Ye,{open:c,onClose:()=>o(!1),sectionId:l}),e.jsx(Ze,{open:s,onClose:()=>t(!1),sectionId:l}),e.jsx(as,{open:h,onClose:()=>d(!1)}),g&&e.jsx(ss,{sectionId:l}),e.jsx(Re,{})]})};export{us as default};
