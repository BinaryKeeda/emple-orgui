import{r as n,Y as R,w as B,x as F,j as e,A as E,y as M,I as q,t as T,B as w}from"./index-BND61U3m.js";import{u as z}from"./useQuery-BRJ4XJjk.js";import{T as L,a as U,S as W}from"./TextField-0UNu1zPO.js";import{I as _,S as O}from"./Search-NTtwA6xH.js";import{M as m}from"./MenuItem-0GibZJVj.js";import{T as j}from"./Typography-TXFHzf7U.js";import{T as H,a as K,b as Q,c as b,d as t,e as Y}from"./TableRow-BfiiyNSs.js";import{P as G}from"./Modal-DSMRkxv-.js";import{D as J}from"./Delete-BRbaVwSY.js";import{D as V,a as X,b as Z,c as ee,d as se}from"./DialogTitle-4IPC-U-3.js";import{B as C}from"./Button-DqZ5OTT3.js";const te=async(r,u,o,x,a,l)=>(await T.get(`${w}/api/campus/students/${r}?page=${u}&limit=${o}&search=${x}&role=${a}&status=${l}`,{withCredentials:!0})).data,he=()=>{const[r,u]=n.useState(""),[o,x]=n.useState(r),[a,l]=n.useState(1),[i,N]=n.useState("all"),[A,c]=n.useState(!1),[f,g]=n.useState(null),d=10,{id:h}=R(),{enqueueSnackbar:y}=B(),D=F(s=>s.auth.user);n.useEffect(()=>{const s=setTimeout(()=>{x(r),l(1)},400);return()=>clearTimeout(s)},[r]);const{data:S,isLoading:I,refetch:$}=z({queryKey:["students",h,a,o,i],queryFn:()=>te(h,a,d,o,"all",i)}),k=s=>{g(s),c(!0)},P=async()=>{if(f)try{await T.delete(`${w}/api/campus/students/${h}/${f}`,{withCredentials:!0}),y("Student removed successfully!",{variant:"success"}),$()}catch(s){console.error("Failed to remove student",s),y("Failed to remove student!",{variant:"error"})}finally{c(!1),g(null)}},v=S?.data||[],p=S?.total||0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(E,{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center",children:[e.jsx(L,{value:r,onChange:s=>u(s.target.value),size:"small",label:"Search by name or email",InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx(O,{})})},sx:{maxWidth:280}}),D?.user.role=="campus-superadmin"&&e.jsx(U,{size:"small",sx:{minWidth:160},children:e.jsxs(W,{value:i,onChange:s=>N(s.target.value),children:[e.jsx(m,{value:"all",children:"All Statuses"}),e.jsx(m,{value:"member",children:"Member"}),e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"admin",children:"Admin"})]})})]}),I?e.jsx(j,{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(H,{component:G,className:"shadow mt-6 rounded-lg",children:e.jsxs(K,{children:[e.jsx(Q,{className:"bg-orange-50",children:e.jsxs(b,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsxs(Y,{children:[v.length===0&&e.jsx(b,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(j,{color:"textSecondary",children:"No students found"})})}),v.map(s=>e.jsxs(b,{hover:!0,children:[e.jsx(t,{children:s.name}),e.jsx(t,{children:s.email}),e.jsx(t,{children:s.role}),e.jsx(t,{children:s.status==="member"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded",children:"Member"}):s.status==="admin"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded",children:"Admin"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-yellow-700 bg-yellow-100 rounded",children:"Pending"})}),e.jsx(t,{children:e.jsx(M,{title:"Remove Student",children:e.jsx(q,{size:"small",color:"error",onClick:()=>k(s._id),children:e.jsx(J,{})})})})]},s._id))]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs(j,{variant:"body2",color:"textSecondary",children:["Showing ",(a-1)*d+1," - ",Math.min(a*d,p)," of ",p]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:a===1,onClick:()=>l(s=>s-1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Prev"}),e.jsx("button",{disabled:a*d>=p,onClick:()=>l(s=>s+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Next"})]})]})]}),e.jsxs(V,{open:A,onClose:()=>c(!1),children:[e.jsx(X,{children:"Confirm Removal"}),e.jsx(Z,{children:e.jsx(ee,{children:"Are you sure you want to remove this student? This action cannot be undone."})}),e.jsxs(se,{children:[e.jsx(C,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(C,{color:"error",onClick:P,children:"Remove"})]})]})]})};export{he as S};
