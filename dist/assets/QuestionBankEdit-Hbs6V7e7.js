import{w as de,j as e,aA as he,aB as G,aC as pe,aD as xe,aE as fe,r as y,at as ge,E as me,aF as ve,M as be,S as b,z as m,R as Q,C as _,x as V,B as Y,a5 as A,af as z,aG as je,aH as ye,ag as Ce,P as U,as as we,aI as Se}from"./index-BwMterpV.js";import{r as Ne,u as I,w as Qe}from"./xlsx-DSqvgYLF.js";import{U as W}from"./Upload-CQlKuIch.js";import{D as T}from"./Download-CgKHkEyu.js";import{A as X,a as Z,b as ee}from"./AccordionSummary-BR7A7edA.js";const te=de(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}));var Pe=class extends he{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:G()})}getOptimisticResult(s){return s.behavior=G(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){const{state:n}=s,f=super.createResult(s,t),{isFetching:g,isRefetching:u,isError:d,isRefetchError:o}=f,p=n.fetchMeta?.fetchMore?.direction,r=d&&p==="forward",i=g&&p==="forward",h=d&&p==="backward",j=g&&p==="backward";return{...f,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:xe(t,n.data),hasPreviousPage:pe(t,n.data),isFetchNextPageError:r,isFetchingNextPage:i,isFetchPreviousPageError:h,isFetchingPreviousPage:j,isRefetchError:o&&!r&&!h,isRefetching:u&&!i&&!j}}};function Me(s,t){return fe(s,Pe)}const ke={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function Ae({onSubmit:s}){const[t,n]=y.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[f,g]=y.useState(!1),u=(r,i)=>{if(!t||!t.options)return;const h=[...t.options];h[r]={...h[r],text:i},n({...t,options:h})},d=r=>{if(!t||!t.options)return;const i=t?.options.map((h,j)=>({...h,isCorrect:j===r}));n({...t,options:i})},o=r=>{if(!t||!t.options)return;const i=[...t.options];i[r].isCorrect=!i[r].isCorrect,n({...t,options:i})},p=async()=>{try{g(!0),await s([t]),n({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(r){console.error(r)}finally{g(!1)}};return e.jsxs(b,{className:"space-y-4",children:[e.jsx(A,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:r=>n({...t,question:r.target.value})}),e.jsx(A,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:r=>n({...t,topic:r.target.value})}),e.jsx(A,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:r=>n({...t,marks:parseFloat(r.target.value)})}),e.jsx(A,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:r=>n({...t,negative:parseFloat(r.target.value)})}),e.jsxs(A,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:r=>{const i=r.target.value,h=Array(4).fill({text:"",isCorrect:!1});n({...t,category:i,options:h,answer:""})},children:[e.jsx(z,{value:"MCQ",children:"MCQ"}),e.jsx(z,{value:"MSQ",children:"MSQ"}),e.jsx(z,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(A,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:r=>n({...t,answer:r.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&e.jsxs(b,{children:[e.jsx(m,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options&&t.options.map((r,i)=>e.jsxs(b,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(je,{size:"small",checked:r.isCorrect,onChange:()=>d(i)}):e.jsx(ye,{size:"small",checked:r.isCorrect,onChange:()=>o(i)}),e.jsx(A,{size:"small",fullWidth:!0,label:`Option ${i+1}`,value:r.text,onChange:h=>u(i,h.target.value)})]},i))]}),e.jsx(Q,{variant:"contained",onClick:p,disabled:f,children:f?"Submitting...":"Add Question"})]})}function Re({open:s,onClose:t,onSuccess:n,bankId:f}){const[g,u]=y.useState(null),[d,o]=y.useState([]),p=ge(),{enqueueSnackbar:r}=me(),{mutateAsync:i,isPending:h}=ve({mutationFn:async a=>{await V.post(`${Y}/api/admin/add/questionbanks/questions/${f}/`,a,{withCredentials:!0})},onSuccess:()=>{r("Questions added successfully!",{variant:"success"}),p.invalidateQueries({queryKey:["questionBank",f]}),t(),n()},onError:a=>{r(a?.response?.data?.message||"Failed to add questions",{variant:"error"})}}),j=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),v=JSON.parse(c);o(v)}catch{u("Invalid JSON format")}},P=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.arrayBuffer(),v=Ne(c,{type:"array"}),N=v.Sheets[v.SheetNames[0]],w=I.sheet_to_json(N).map(O=>{const{question:B,category:se,marks:re,negative:ae,topic:ne,answer:oe,option1:ie,correct1:K,option2:ce,correct2:$,option3:le,correct3:J,option4:ue,correct4:L}=O,F={question:B||"",category:se||"MCQ",marks:parseFloat(re)||1,negative:parseFloat(ae)||0,topic:ne||""};return F.category==="Text"?{...F,answer:oe||"",options:[]}:{...F,options:[{text:ie||"",isCorrect:K===!0||K==="true"},{text:ce||"",isCorrect:$===!0||$==="true"},{text:le||"",isCorrect:J===!0||J==="true"},{text:ue||"",isCorrect:L===!0||L==="true"}]}});o(w)}catch{u("Invalid Excel format")}},x=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),v=M(c);if(v.length===0){u("No valid AIKEN questions found");return}u(null),o(v)}catch(c){console.error(c),u("Invalid AIKEN format")}};function M(a){const l=a.split(/\r?\n/).map(w=>w.trim()),c=[];let v="",N=[],E="";for(const w of l)w&&(/^ANSWER:/i.test(w)?(E=w.split(":")[1].trim().toUpperCase(),N=N.map((O,B)=>({...O,isCorrect:String.fromCharCode(65+B)===E})),c.push({question:v,category:"MCQ",marks:1,negative:0,topic:"",options:N}),v="",N=[],E=""):/^[A-D]\)/i.test(w)?N.push({text:w.substring(2).trim(),isCorrect:!1}):(v&&N.length>0&&(N=[]),v=w));return c}const S=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",options:[{text:"Berlin",isCorrect:!1},{text:"Madrid",isCorrect:!1},{text:"Paris",isCorrect:!0},{text:"Rome",isCorrect:!1}]}],l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.json",c.click()},k=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",option1:"Berlin",correct1:!1,option2:"Madrid",correct2:!1,option3:"Paris",correct3:!0,option4:"Rome",correct4:!1}],l=I.json_to_sheet(a),c=I.book_new();I.book_append_sheet(c,l,"Sample"),Qe(c,"sample_questions.xlsx")},R=()=>{const a=`What is the capital of France?
                    A) Berlin
                    B) Madrid
                    C) Paris
                    D) Rome
                    ANSWER: C`,l=new Blob([a],{type:"text/plain"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.txt",c.click()},C=async a=>{await i(a)};return e.jsx(be,{open:s,onClose:t,children:e.jsxs(b,{sx:{...ke,maxHeight:"90vh",overflowY:"auto"},children:[e.jsx(m,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap",children:[e.jsxs(Q,{variant:"outlined",component:"label",startIcon:e.jsx(W,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:j})]}),e.jsx(Q,{startIcon:e.jsx(T,{}),onClick:S,children:"Download Sample"}),e.jsxs(Q,{variant:"outlined",component:"label",startIcon:e.jsx(W,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:P})]}),e.jsx(Q,{startIcon:e.jsx(T,{}),onClick:k,children:"Download Sample"}),e.jsxs(Q,{variant:"outlined",component:"label",startIcon:e.jsx(W,{fontSize:"small"}),children:["Upload AIKEN (.txt)",e.jsx("input",{type:"file",accept:".txt",hidden:!0,onChange:x})]}),e.jsx(Q,{startIcon:e.jsx(T,{}),onClick:R,children:"Download Sample"})]}),g&&e.jsx(m,{color:"error",variant:"body2",className:"mb-2",children:g}),e.jsx(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(Ae,{onSubmit:C}),d.length>0&&e.jsxs(b,{className:"mt-6",children:[e.jsxs(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:["Preview Uploaded Questions (",d.length,")"]}),d.map((a,l)=>e.jsxs(X,{defaultExpanded:l===0,children:[e.jsx(Z,{expandIcon:e.jsx(te,{}),children:e.jsxs(m,{children:["Q",l+1,": ",a.question.slice(0,80),"..."]})}),e.jsxs(ee,{children:[e.jsxs(m,{children:[e.jsx("strong",{children:"Topic:"})," ",a.topic]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Marks:"})," ",a.marks]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Negative:"})," ",a.negative]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),(a.category==="MCQ"||a.category==="MSQ")&&e.jsx(b,{className:"mt-2 space-y-1",children:a.options?.map((c,v)=>e.jsxs(m,{children:[c.isCorrect?"✅":"⬜️"," Option ",v+1,": ",c.text]},v))})]})]},l)),e.jsx(Q,{className:"mt-4",variant:"contained",disabled:h,onClick:()=>C(d),children:h?"Submitting...":"Submit All Previewed Questions"})]}),h&&e.jsx(_,{className:"mt-4"})]})})}var D=new Map,q=new WeakMap,H=0,Ee;function Ie(s){return s?(q.has(s)||(H+=1,q.set(s,H.toString())),q.get(s)):"0"}function qe(s){return Object.keys(s).sort().filter(t=>s[t]!==void 0).map(t=>`${t}_${t==="root"?Ie(s.root):s[t]}`).toString()}function Oe(s){const t=qe(s);let n=D.get(t);if(!n){const f=new Map;let g;const u=new IntersectionObserver(d=>{d.forEach(o=>{var p;const r=o.isIntersecting&&g.some(i=>o.intersectionRatio>=i);s.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=r),(p=f.get(o.target))==null||p.forEach(i=>{i(r,o)})})},s);g=u.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),n={id:t,observer:u,elements:f},D.set(t,n)}return n}function Be(s,t,n={},f=Ee){if(typeof window.IntersectionObserver>"u"&&f!==void 0){const p=s.getBoundingClientRect();return t(f,{isIntersecting:f,target:s,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:p,intersectionRect:p,rootBounds:p}),()=>{}}const{id:g,observer:u,elements:d}=Oe(n),o=d.get(s)||[];return d.has(s)||d.set(s,o),o.push(t),u.observe(s),function(){o.splice(o.indexOf(t),1),o.length===0&&(d.delete(s),u.unobserve(s)),d.size===0&&(u.disconnect(),D.delete(g))}}function Fe({threshold:s,delay:t,trackVisibility:n,rootMargin:f,root:g,triggerOnce:u,skip:d,initialInView:o,fallbackInView:p,onChange:r}={}){var i;const[h,j]=y.useState(null),P=y.useRef(r),x=y.useRef(o),[M,S]=y.useState({inView:!!o,entry:void 0});P.current=r,y.useEffect(()=>{if(x.current===void 0&&(x.current=o),d||!h)return;let a;return a=Be(h,(l,c)=>{const v=x.current;x.current=l,!(v===void 0&&!l)&&(S({inView:l,entry:c}),P.current&&P.current(l,c),c.isIntersecting&&u&&a&&(a(),a=void 0))},{root:g,rootMargin:f,threshold:s,trackVisibility:n,delay:t},p),()=>{a&&a()}},[Array.isArray(s)?s.toString():s,h,g,f,u,d,n,p,t]);const k=(i=M.entry)==null?void 0:i.target,R=y.useRef(void 0);!h&&k&&!u&&!d&&R.current!==k&&(R.current=k,S({inView:!!o,entry:void 0}),x.current=o);const C=[j,M.inView,M.entry];return C.ref=C[0],C.inView=C[1],C.entry=C[2],C}function Ke(){const{slug:s}=Ce(),[t,n]=y.useState(!1),{ref:f,inView:g}=Fe(),{data:u,fetchNextPage:d,hasNextPage:o,isFetchingNextPage:p,isLoading:r,isError:i,refetch:h}=Me({queryKey:["questionBank",s],queryFn:async({pageParam:x})=>(await V.get(`${Y}/api/admin/get/questionbank/questions/${s}?page=${x}&limit=10`,{withCredentials:!0})).data,initialPageParam:1,getNextPageParam:x=>x.hasMore?x.page+1:void 0,enabled:!!s}),j=u?.pages?.[0]?.bankDetails,P=u?u.pages.flatMap(x=>x.questions):[];return g&&o&&!p&&d(),e.jsxs(b,{mx:"auto",px:2,py:4,children:[e.jsxs(U,{elevation:3,sx:{p:4,borderRadius:3,mb:5,display:"flex",flexDirection:"column",gap:2},children:[t&&e.jsx(Re,{open:!0,onSuccess:()=>{n(!1),h()},onClose:()=>n(!1),bankId:s||""}),e.jsx(m,{variant:"h5",fontWeight:"bold",children:j?.name||"Question Bank"}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Category: ",j?.category||"N/A"]}),e.jsx(we,{direction:"row",spacing:2,mt:1,children:e.jsx(Q,{variant:"contained",color:"primary",onClick:()=>n(!0),sx:{textTransform:"none",borderRadius:2},children:"Add Question"})})]}),r&&e.jsx(b,{textAlign:"center",py:4,children:e.jsx(_,{})}),i&&e.jsx(m,{color:"error",textAlign:"center",children:"Failed to load questions."}),e.jsx(b,{display:"flex",flexWrap:"wrap",gap:2,children:P.map((x,M)=>e.jsx(b,{flex:"1 1 calc(33.33% - 16px)",minWidth:"300px",children:e.jsxs(X,{sx:{borderRadius:2},children:[e.jsx(Z,{expandIcon:e.jsx(te,{}),children:e.jsxs(b,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(m,{fontWeight:600,flex:1,pr:1,children:x.question||x.title||"Untitled Question"}),e.jsx(Se,{label:x.category,color:"primary",variant:"outlined",size:"small"})]})}),e.jsx(ee,{children:x.category==="MCQ"?e.jsx(b,{display:"flex",flexWrap:"wrap",gap:1,children:x.options?.map((S,k)=>e.jsx(b,{flex:"1 1 calc(50% - 8px)",children:e.jsxs(U,{elevation:1,sx:{p:1,bgcolor:S.isCorrect?"#dcfce7":"#f3f4f6",border:S.isCorrect?"1px solid #22c55e":"1px solid #d1d5db"},children:[String.fromCharCode(65+k),". ",S.text]})},S._id||k))}):e.jsxs(b,{mt:2,children:[e.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Answer:"}),e.jsx(U,{variant:"outlined",sx:{p:1},children:e.jsx(m,{children:x.answer||"Not Provided"})})]})})]})},x._id||M))}),e.jsx(b,{ref:f,display:"flex",justifyContent:"center",py:3,children:p&&e.jsx(_,{size:24})}),!o&&!r&&e.jsx(m,{textAlign:"center",mt:3,color:"text.secondary",children:"No more questions."})]})}export{Ke as default};
