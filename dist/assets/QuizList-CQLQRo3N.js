import{Y as $,r as n,Z as _,j as e,y as u,I as p,_ as z,t as b,B as D}from"./index-BND61U3m.js";import{u as O}from"./useQuery-BRJ4XJjk.js";import{P as L}from"./Modal-DSMRkxv-.js";import{T as F}from"./TextField-0UNu1zPO.js";import{I as q,S as H}from"./Search-NTtwA6xH.js";import{T as K,a as V,b as M,c as m,d as t,e as N}from"./TableRow-BfiiyNSs.js";import{V as U,E as W,S as Y,A as Z}from"./Visibility-Cdt1f8ej.js";import{D as G}from"./Delete-BRbaVwSY.js";import{T as J}from"./TablePagination-Ck6frH36.js";import{D as X,a as ee,b as se,c as te,d as ne}from"./DialogTitle-4IPC-U-3.js";import{B as S}from"./Button-DqZ5OTT3.js";import"./Typography-TXFHzf7U.js";import"./MenuItem-0GibZJVj.js";import"./dividerClasses-BRtudpdH.js";const re=async({sectionId:r,page:a,limit:o,search:i})=>(await b.get(`${D}/api/campus/quiz/get/section/${r}`,{params:{page:a,limit:o,search:i},withCredentials:!0})).data,ye=()=>{const{id:r}=$(),[a,o]=n.useState(0),[i,g]=n.useState(10),[c,T]=n.useState(""),[x,P]=n.useState(c),[w,d]=n.useState(!1),[j,f]=n.useState(null),[l,h]=n.useState({open:!1,message:"",severity:"success"}),v=_();n.useEffect(()=>{const s=setTimeout(()=>{P(c),o(0)},400);return()=>clearTimeout(s)},[c]);const{data:y,isLoading:Q}=O({queryKey:["quizzes",r,a,i,x],queryFn:()=>re({sectionId:r,page:a+1,limit:i,search:x}),enabled:!!r,staleTime:1e3*60*5}),C=y?.quizzes??[],A=y?.totalQuizzes??0,k=(s,R)=>o(R),E=s=>{g(parseInt(s.target.value,10)),o(0)},B=s=>{f(s),d(!0)},I=async()=>{if(j)try{await b.delete(`${D}/api/campus/sections/quiz/delete/${j._id}`,{withCredentials:!0}),h({open:!0,message:"Quiz deleted successfully",severity:"success"}),v.invalidateQueries({queryKey:["quizzes",r,a,i,x]})}catch{h({open:!0,message:"Failed to delete quiz",severity:"error"})}finally{d(!1),f(null)}};return e.jsxs(L,{sx:{p:3,borderRadius:3,overflow:"hidden"},children:[e.jsx(F,{size:"small",placeholder:"Search quizzes...",value:c,onChange:s=>T(s.target.value),sx:{mb:2,width:"100%",maxWidth:400},InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(H,{})})}}),e.jsx(K,{children:e.jsxs(V,{children:[e.jsx(M,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Title"}),e.jsx(t,{children:"Category"}),e.jsx(t,{children:"Difficulty"}),e.jsx(t,{children:"Duration"}),e.jsx(t,{children:"Marks"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Cost"}),e.jsx(t,{align:"center",children:"Actions"}),e.jsx(t,{align:"center",children:"Delete"})]})}),e.jsx(N,{children:Q?e.jsx(m,{children:e.jsx(t,{colSpan:9,align:"center",children:"Loading..."})}):C.length===0?e.jsx(m,{children:e.jsx(t,{colSpan:9,align:"center",children:"No quizzes found."})}):C.map(s=>e.jsxs(m,{hover:!0,children:[e.jsx(t,{children:s.title}),e.jsx(t,{children:s.category}),e.jsx(t,{children:s.difficulty}),e.jsxs(t,{children:[s.duration," min"]}),e.jsx(t,{children:s.marks}),e.jsx(t,{children:s.creator?.name||"-"}),e.jsx(t,{children:e.jsx(u,{title:`Total: ${s.costPerAttempt*s.noOfSubmissions}`,arrow:!0,children:e.jsx("span",{children:(s.costPerAttempt||0)*(s.noOfSubmissions||0)})})}),e.jsxs(t,{align:"center",children:[e.jsx(u,{title:"Preview Quiz",children:e.jsx(p,{component:z,to:`preview/${s.slug}`,color:"primary",size:"small",children:e.jsx(U,{fontSize:"small"})})}),e.jsx(u,{title:"Edit Quiz",children:e.jsx(p,{component:z,to:`edit/${s._id}`,color:"warning",size:"small",children:e.jsx(W,{fontSize:"small"})})})]}),e.jsx(t,{align:"center",children:e.jsx(u,{title:"Delete Quiz",children:e.jsx(p,{color:"error",size:"small",onClick:()=>B(s),children:e.jsx(G,{fontSize:"small"})})})})]},s._id))})]})}),e.jsx(J,{component:"div",count:A,page:a,onPageChange:k,rowsPerPage:i,onRowsPerPageChange:E,rowsPerPageOptions:[5,10,20,50]}),e.jsxs(X,{open:w,onClose:()=>d(!1),children:[e.jsx(ee,{children:"Confirm Deletion"}),e.jsx(se,{children:e.jsxs(te,{children:['Are you sure you want to delete quiz "',j?.title,'"? This action cannot be undone.']})}),e.jsxs(ne,{children:[e.jsx(S,{onClick:()=>d(!1),color:"inherit",children:"Cancel"}),e.jsx(S,{onClick:I,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(Y,{open:l.open,autoHideDuration:3e3,onClose:()=>h({...l,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Z,{onClose:()=>h({...l,open:!1}),severity:l.severity,sx:{width:"100%"},children:l.message})})]})};export{ye as default};
