import{r as b,A as $,j as e,M as _,H as y,N as p,z as M,C as H,x as L,B as P,I as i,aj as w,aE as Y,ab as G}from"./index-BKh3Z22c.js";import{r as K,u as V}from"./xlsx-BTp1RmNK.js";import{U as j}from"./Upload-Bye5JQXs.js";const X={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function Z({onSubmit:C}){const[t,o]=b.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[x,m]=b.useState(!1),v=(a,s)=>{if(!t.options)return;const r=[...t.options];r[a]={...r[a],text:s},o({...t,options:r})},c=a=>{if(!t.options)return;const s=t.options.map((r,u)=>({...r,isCorrect:u===a}));o({...t,options:s})},h=a=>{if(!t.options)return;const s=[...t.options];s[a].isCorrect=!s[a].isCorrect,o({...t,options:s})},f=async()=>{try{m(!0),await C([t]),o({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(a){console.error(a)}finally{m(!1)}};return e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx(i,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:a=>o({...t,question:a.target.value})}),e.jsx(i,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:a=>o({...t,topic:a.target.value})}),e.jsx(i,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:a=>o({...t,marks:parseFloat(a.target.value)})}),e.jsx(i,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:a=>o({...t,negative:parseFloat(a.target.value)})}),e.jsxs(i,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:a=>{const s=a.target.value,r=Array(4).fill({text:"",isCorrect:!1});o({...t,category:s,options:r,answer:""})},children:[e.jsx(w,{value:"MCQ",children:"MCQ"}),e.jsx(w,{value:"MSQ",children:"MSQ"}),e.jsx(w,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(i,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:a=>o({...t,answer:a.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&t.options&&e.jsxs(y,{children:[e.jsx(M,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options.map((a,s)=>e.jsxs(y,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(Y,{size:"small",checked:a.isCorrect,onChange:()=>c(s)}):e.jsx(G,{size:"small",checked:a.isCorrect,onChange:()=>h(s)}),e.jsx(i,{size:"small",fullWidth:!0,label:`Option ${s+1}`,value:a.text,onChange:r=>v(s,r.target.value)})]},s))]}),e.jsx(p,{variant:"contained",onClick:f,disabled:x,children:x?"Submitting...":"Add Question"})]})}function re({open:C,onClose:t,onSuccess:o,testId:x,sectionId:m}){const[v,c]=b.useState(!1),[h,f]=b.useState(null),{enqueueSnackbar:a}=$(),s=async d=>{const n=d.target.files?.[0];if(n)try{c(!0);const l=await n.text(),g=JSON.parse(l);await u(g)}catch(l){console.error(l),f("Invalid JSON format")}finally{c(!1)}},r=async d=>{const n=d.target.files?.[0];if(n)try{c(!0);const l=await n.arrayBuffer(),g=K(l,{type:"array"}),T=g.Sheets[g.SheetNames[0]],q=V.sheet_to_json(T).map(E=>{const{question:O,category:A,marks:I,negative:U,topic:F,answer:W,option1:B,correct1:Q,option2:D,correct2:k,option3:J,correct3:N,option4:R,correct4:z}=E,S={question:O||"",category:A||"MCQ",marks:parseFloat(I)||1,negative:parseFloat(U)||0,topic:F||""};return S.category==="Text"?{...S,answer:W||""}:{...S,options:[{text:B||"",isCorrect:Q===!0||Q==="true"},{text:D||"",isCorrect:k===!0||k==="true"},{text:J||"",isCorrect:N===!0||N==="true"},{text:R||"",isCorrect:z===!0||z==="true"}]}});await u(q)}catch(l){console.error(l),f("Invalid Excel format")}finally{c(!1)}},u=async d=>{try{await L.post(`${P}/api/admin/tests/${x}/sections/${m}/questions`,d,{withCredentials:!0}),a("Questions added successfully!",{variant:"success"}),t(),o()}catch(n){console.error(n),a("Failed to submit questions",{variant:"error"})}};return e.jsx(_,{open:C,onClose:t,children:e.jsxs(y,{sx:X,children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs(p,{variant:"outlined",component:"label",startIcon:e.jsx(j,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:s})]}),e.jsxs(p,{variant:"outlined",component:"label",startIcon:e.jsx(j,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:r})]})]}),h&&e.jsx(M,{color:"error",variant:"body2",className:"mb-2",children:h}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(p,{variant:"outlined",href:"/data/sample-json.json",download:!0,startIcon:e.jsx(j,{fontSize:"small"}),children:"Download JSON Template"}),e.jsx(p,{variant:"outlined",href:"/data/sample-excel.xlsx",download:!0,startIcon:e.jsx(j,{fontSize:"small"}),children:"Download Excel Template"})]}),e.jsx(M,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(Z,{onSubmit:u}),v&&e.jsx(H,{className:"mt-4"})]})})}export{re as default};
