import{E as D,j as o,x as E,a3 as H,A as L,r as p,p as Z,q as K,t as X,N as ee,s as te,y as F,z as oe,C as G,c as B,G as se,e as ae,B as ne}from"./index-CEMFlCi4.js";import{r as re,u as ie}from"./xlsx-DSqvgYLF.js";import{u as le,e as ce,M as de,T as C}from"./TextField-CBgjTSJO.js";import{T}from"./Typography-Bh9Wa-AS.js";import{B as z}from"./Button-DwPzP1N8.js";import{M as A}from"./MenuItem-Cy4sf0OO.js";import{S as ue,C as pe}from"./Checkbox-CUA8ugq3.js";import"./index-Cop6QSZX.js";const me=D(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),fe=D(o.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),xe=E("span",{name:"MuiRadioButtonIcon",shouldForwardProp:H})({position:"relative",display:"flex"}),he=E(me,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),ge=E(fe,{name:"MuiRadioButtonIcon"})(L(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function V(t){const{checked:e=!1,classes:a={},fontSize:i}=t,l={...t,checked:e};return o.jsxs(xe,{className:a.root,ownerState:l,children:[o.jsx(he,{fontSize:i,className:a.background,ownerState:l}),o.jsx(ge,{fontSize:i,className:a.dot,ownerState:l})]})}const Ce=p.createContext(void 0);function ye(){return p.useContext(Ce)}function ve(t){return K("MuiRadio",t)}const _=Z("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),be=t=>{const{classes:e,color:a,size:i}=t,l={root:["root",`color${F(a)}`,i!=="medium"&&`size${F(i)}`]};return{...e,...oe(l,ve,e)}},je=E(ue,{shouldForwardProp:t=>H(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,a.size!=="medium"&&e[`size${F(a.size)}`],e[`color${F(a.color)}`]]}})(L(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${_.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[e].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e,disabled:!1},style:{[`&.${_.checked}`]:{color:(t.vars||t).palette[e].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Se(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const we=o.jsx(V,{checked:!0}),ke=o.jsx(V,{}),Re=p.forwardRef(function(e,a){const i=X({props:e,name:"MuiRadio"}),{checked:l,checkedIcon:y=we,color:m="primary",icon:f=ke,name:v,onChange:s,size:n="medium",className:r,disabled:d,disableRipple:u=!1,slots:c={},slotProps:x={},inputProps:O,...W}=i,M=le();let h=d;M&&typeof h>"u"&&(h=M.disabled),h??=!1;const b={...i,disabled:h,disableRipple:u,color:m,size:n},I=be(b),g=ye();let j=l;const q=ce(s,g&&g.onChange);let S=v;g&&(typeof j>"u"&&(j=Se(g.value,i.value)),typeof S>"u"&&(S=g.name));const w=x.input??O,[N,U]=ee("root",{ref:a,elementType:je,className:te(I.root,r),shouldForwardComponentProp:!0,externalForwardedProps:{slots:c,slotProps:x,...W},getSlotProps:k=>({...k,onChange:(P,...R)=>{k.onChange?.(P,...R),q(P,...R)}}),ownerState:b,additionalProps:{type:"radio",icon:p.cloneElement(f,{fontSize:f.props.fontSize??n}),checkedIcon:p.cloneElement(y,{fontSize:y.props.fontSize??n}),disabled:h,name:S,checked:j,slots:c,slotProps:{input:typeof w=="function"?w(b):w}}});return o.jsx(N,{...U,classes:I})}),Q=D(o.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),ze={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function Me({onSubmit:t}){const[e,a]=p.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[i,l]=p.useState(!1),y=(s,n)=>{if(!e.options)return;const r=[...e.options];r[s]={...r[s],text:n},a({...e,options:r})},m=s=>{if(!e.options)return;const n=e.options.map((r,d)=>({...r,isCorrect:d===s}));a({...e,options:n})},f=s=>{if(!e.options)return;const n=[...e.options];n[s].isCorrect=!n[s].isCorrect,a({...e,options:n})},v=async()=>{try{l(!0),await t([e]),a({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(s){console.error(s)}finally{l(!1)}};return o.jsxs(B,{className:"space-y-4",children:[o.jsx(C,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:e.question,onChange:s=>a({...e,question:s.target.value})}),o.jsx(C,{size:"small",label:"Topic",fullWidth:!0,value:e.topic,onChange:s=>a({...e,topic:s.target.value})}),o.jsx(C,{size:"small",label:"Marks",type:"number",value:e.marks,onChange:s=>a({...e,marks:parseFloat(s.target.value)})}),o.jsx(C,{size:"small",label:"Negative Marks",type:"number",value:e.negative,onChange:s=>a({...e,negative:parseFloat(s.target.value)})}),o.jsxs(C,{size:"small",select:!0,label:"Category",fullWidth:!0,value:e.category,onChange:s=>{const n=s.target.value,r=Array(4).fill({text:"",isCorrect:!1});a({...e,category:n,options:r,answer:""})},children:[o.jsx(A,{value:"MCQ",children:"MCQ"}),o.jsx(A,{value:"MSQ",children:"MSQ"}),o.jsx(A,{value:"Text",children:"Text"})]}),e.category==="Text"&&o.jsx(C,{size:"small",label:"Answer",fullWidth:!0,value:e.answer,onChange:s=>a({...e,answer:s.target.value})}),(e.category==="MCQ"||e.category==="MSQ")&&e.options&&o.jsxs(B,{children:[o.jsx(T,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),e.options.map((s,n)=>o.jsxs(B,{className:"flex items-center gap-2 mb-2",children:[e.category==="MCQ"?o.jsx(Re,{size:"small",checked:s.isCorrect,onChange:()=>m(n)}):o.jsx(pe,{size:"small",checked:s.isCorrect,onChange:()=>f(n)}),o.jsx(C,{size:"small",fullWidth:!0,label:`Option ${n+1}`,value:s.text,onChange:r=>y(n,r.target.value)})]},n))]}),o.jsx(z,{variant:"contained",onClick:v,disabled:i,children:i?"Submitting...":"Add Question"})]})}function qe({open:t,onClose:e,onSuccess:a,testId:i,sectionId:l}){const[y,m]=p.useState(!1),[f,v]=p.useState(null),s=async d=>{const u=d.target.files?.[0];if(u)try{m(!0);const c=await u.text(),x=JSON.parse(c);await r(x)}catch(c){console.error(c),v("Invalid JSON format")}finally{m(!1)}},n=async d=>{const u=d.target.files?.[0];if(u)try{m(!0);const c=await u.arrayBuffer(),x=re(c,{type:"array"}),O=x.Sheets[x.SheetNames[0]],M=ie.sheet_to_json(O).map(h=>{const{question:b,category:I,marks:g,negative:j,topic:q,answer:S,option1:w,correct1:N,option2:U,correct2:k,option3:P,correct3:R,option4:Y,correct4:J}=h,$={question:b||"",category:I||"MCQ",marks:parseFloat(g)||1,negative:parseFloat(j)||0,topic:q||""};return $.category==="Text"?{...$,answer:S||""}:{...$,options:[{text:w||"",isCorrect:N===!0||N==="true"},{text:U||"",isCorrect:k===!0||k==="true"},{text:P||"",isCorrect:R===!0||R==="true"},{text:Y||"",isCorrect:J===!0||J==="true"}]}});await r(M)}catch(c){console.error(c),v("Invalid Excel format")}finally{m(!1)}},r=async d=>{try{await ae.post(`${ne}/api/admin/tests/${i}/sections/${l}/questions`,d,{withCredentials:!0}),alert("Questions added successfully!"),e(),a()}catch(u){console.error(u),alert("Failed to submit questions")}};return o.jsx(de,{open:t,onClose:e,children:o.jsxs(B,{sx:ze,children:[o.jsx(T,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),o.jsxs("div",{className:"flex gap-4 mb-4",children:[o.jsxs(z,{variant:"outlined",component:"label",startIcon:o.jsx(Q,{fontSize:"small"}),children:["Upload JSON",o.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:s})]}),o.jsxs(z,{variant:"outlined",component:"label",startIcon:o.jsx(Q,{fontSize:"small"}),children:["Upload Excel",o.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:n})]})]}),f&&o.jsx(T,{color:"error",variant:"body2",className:"mb-2",children:f}),o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx(z,{variant:"outlined",href:"/data/sample-json.json",download:!0,startIcon:o.jsx(Q,{fontSize:"small"}),children:"Download JSON Template"}),o.jsx(z,{variant:"outlined",href:"/data/sample-excel.xlsx",download:!0,startIcon:o.jsx(Q,{fontSize:"small"}),children:"Download Excel Template"})]}),o.jsx(T,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),o.jsx(Me,{onSubmit:r}),y&&o.jsx(se,{className:"mt-4"})]})})}export{qe as default};
