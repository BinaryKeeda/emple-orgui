import{r as p,j as e,I,t as z}from"./index-BvY5VVbY.js";import{u as D}from"./index-D1xyAGDl.js";import{u as i,w as P,r as Q}from"./xlsx-DSqvgYLF.js";import{C as T}from"./UploadFile-Bhng2Bha.js";import{B as y}from"./Button-3qkbKROX.js";import"./tslib.es6-BYppDQt_.js";const A="http://localhost:5000";function V({onSuccess:j,onError:v,setModalClose:m,id:x}){const[c,w]=p.useState(null),[r,k]=p.useState([]),[u,h]=p.useState(!1),{getRootProps:N,getInputProps:C}=D({onDropAccepted:t=>{const o=t[0];w(o),E(o)},accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"]}}),E=t=>{const o=new FileReader;o.onload=l=>{const a=l.target?.result;if(typeof a!="string")return;const f=Q(a,{type:"binary"}),q=f.Sheets[f.SheetNames[0]],B=i.sheet_to_json(q).map(s=>{const g=s.category?.trim(),b={quizId:x,question:s.question,category:g,marks:Number(s.marks),negative:Number(s.negative)||0};if(g==="Text")return{...b,answer:s.answer||""};const d=[{text:s.option1,isCorrect:!1},{text:s.option2,isCorrect:!1},{text:s.option3,isCorrect:!1},{text:s.option4,isCorrect:!1}];return(typeof s.correctOptions=="string"?s.correctOptions.split(",").map(n=>parseInt(n.trim(),10)-1):[]).forEach(n=>{d[n]&&(d[n].isCorrect=!0)}),{...b,options:d}});k(B)},o.readAsBinaryString(t)},S=()=>{const t=["question","category","marks","negative","answer","option1","option2","option3","option4","correctOptions"],o=["What is the capital of France?","MCQ",2,.5,"","Paris","London","Berlin","Madrid",1],l=i.aoa_to_sheet([t,o]),a=i.book_new();i.book_append_sheet(a,l,"Template"),P(a,"quiz_template.xlsx")},_=async()=>{if(r.length){h(!0);try{await z.post(`${A}/api/admin/quiz/add/questions`,{quizId:x,data:r},{headers:{"Content-Type":"application/json"},withCredentials:!0}),j(),m(!0)}catch(t){console.error(t),v()}finally{h(!1)}}};return e.jsx("div",{className:"h-screen w-screen bg-opacity-25 px-36 py-24 bg-black fixed top-0 left-0 z-[2099]",children:e.jsxs("div",{className:"rounded-md relative h-full w-full bg-white overflow-y-auto",children:[e.jsx("div",{className:"flex justify-end p-2",children:e.jsx(I,{onClick:()=>m(!0),children:e.jsx(T,{})})}),e.jsxs("div",{className:"mx-8 mt-4 bg-blue-50 border border-blue-300 rounded-md p-4",children:[e.jsx("h2",{className:"text-base font-semibold mb-2",children:"Expected Excel Schema Example:"}),e.jsx("pre",{className:"bg-white text-xs rounded-md p-3 overflow-x-auto whitespace-pre-wrap",children:`| question                 | category | marks | negative | answer                                   | option1  | option2 | option3 | option4 | correctOptions |
|--------------------------|----------|--------|----------|-------------------------------------------|----------|---------|---------|---------|----------------|
| What is the capital...? | MCQ      | 2      | 0.5      |                                           | Paris    | London  | Berlin  | Madrid  | 1              |
| Which are vowels?        | MSQ      | 3      | 1        |                                           | A        | B       | E       | F       | 1,3            |
| Define gravity.          | Text     | 5      | 0        | Gravity is the force...                   |          |         |         |         |                |`})]}),e.jsxs("section",{className:"p-5 gap-5",children:[e.jsx(y,{variant:"outlined",color:"secondary",onClick:S,sx:{mb:2},children:"Download Excel Template"}),e.jsxs("div",{className:"p-10 cursor-pointer flex justify-center border-dashed border-2 border-black",...N(),children:[e.jsx("input",{...C()}),e.jsx("small",{children:c?c.name:"Upload Excel file (.xlsx/.xls)"})]}),r.length>0&&e.jsxs("div",{className:"mt-4 bg-gray-100 rounded-md p-4 max-h-[300px] overflow-y-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Preview Questions:"}),e.jsx("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:r.map((t,o)=>e.jsxs("li",{children:[e.jsxs("strong",{children:["Q",o+1,":"]})," ",t.question," â€” ",e.jsx("i",{children:t.category})," (",t.marks," marks)"]},o))})]}),c&&r.length>0&&e.jsx(y,{onClick:_,variant:"contained",color:"primary",disabled:u,sx:{mt:2},children:u?"Uploading...":"Validate & Upload"})]})]})})}export{V as default};
