import{Y as w,r as p,w as v,j as e,C as E,t as h,B as u}from"./index-BE6cIAmR.js";import{u as C}from"./useQuery-B0XWEaS6.js";import{B as P}from"./Button-D6KtJqYv.js";import{C as S}from"./CloudDownload-KnzOiu4X.js";const k=async({slug:r,id:t,page:a})=>(await h.get(`${u}/api/campus/test/submissions/${r}/${t}`,{params:{page:a},withCredentials:!0})).data,D=()=>{const{slug:r,id:t}=w(),[a,d]=p.useState(1),[n,c]=p.useState(!1),{enqueueSnackbar:i}=v(),{data:x,isLoading:y,isError:g,refetch:j}=C({queryKey:["testPreview",r,t,a],queryFn:()=>k({slug:r,id:t,page:a}),enabled:!!r&&!!t,staleTime:1e3*60*5}),f=async()=>{if(!(!r||!t)){c(!0);try{const s=await h.get(`${u}/api/campus/test/sections/download/${r}/${t}`,{responseType:"blob",withCredentials:!0}),N=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=window.URL.createObjectURL(N),o=document.createElement("a");o.href=m,o.download=`test_submissions_${r}.xlsx`,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(m),i("Excel exported successfully!",{variant:"success"})}catch(s){console.error("Error downloading Excel:",s),i("Failed to export Excel",{variant:"error"})}finally{c(!1)}}};if(y)return e.jsx("div",{className:"text-center py-10",children:"Loading..."});if(g)return e.jsxs("div",{className:"text-center py-10 text-red-500",children:["Failed to fetch data.",e.jsx("button",{onClick:()=>j(),className:"ml-2 underline text-indigo-600",children:"Retry"})]});const b=x?.list??[],l=x?.totalPages??1;return e.jsxs("div",{className:"p-6 flex flex-col gap-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Test Submissions"}),e.jsx(P,{variant:"contained",color:"success",onClick:f,disabled:n,startIcon:n?e.jsx(E,{size:18,color:"inherit"}):e.jsx(S,{}),children:n?"Exporting...":"Download Excel"})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow-md",children:e.jsxs("table",{className:"w-full text-sm text-left border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Name"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Email"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Score"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Attempt"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Submitted At"})]})}),e.jsxs("tbody",{children:[b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.name}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.email}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.score}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.attemptNo}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:new Date(s.updatedAt).toLocaleString()})]},s._id)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"No submissions found."})})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Page ",a," of ",l]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>d(s=>Math.max(s-1,1)),disabled:a===1,className:"px-3 py-1 text-sm border rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Prev"}),e.jsx("button",{onClick:()=>d(s=>Math.min(s+1,l)),disabled:a===l,className:"px-3 py-1 text-sm border rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Next"})]})]})]})};export{D as default};
