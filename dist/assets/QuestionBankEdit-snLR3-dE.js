import{c as de,j as e,aD as ue,aE as D,aF as he,aG as xe,aH as pe,r as y,ai as $,A as fe,aI as ge,M as me,H as j,z as m,K as ve,al as je,N as S,C as B,x as J,B as L,I as Q,aj as I,aJ as be,ab as ye,ak as Ce,P as q,aw as we,aK as Se}from"./index-D5BKi87E.js";import{r as Ne,u as k,w as Pe}from"./xlsx-BTp1RmNK.js";import{p as Qe}from"./aikenParser-D2gryyxM.js";import{U as F}from"./Upload-DcwnOFEn.js";import{D as O}from"./Download-CeKe9F_j.js";import{A as H,a as G,b as V}from"./AccordionSummary-Dz6EIla3.js";const Y=de(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}));var Me=class extends ue{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:D()})}getOptimisticResult(s){return s.behavior=D(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){const{state:n}=s,p=super.createResult(s,t),{isFetching:g,isRefetching:d,isError:u,isRefetchError:o}=p,h=n.fetchMeta?.fetchMore?.direction,v=u&&h==="forward",r=g&&h==="forward",i=u&&h==="backward",f=g&&h==="backward";return{...p,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:xe(t,n.data),hasPreviousPage:he(t,n.data),isFetchNextPageError:v,isFetchingNextPage:r,isFetchPreviousPageError:i,isFetchingPreviousPage:f,isRefetchError:o&&!v&&!i,isRefetching:d&&!r&&!f}}};function ke(s,t){return pe(s,Me)}const Re={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function Ae({onSubmit:s}){const[t,n]=y.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[p,g]=y.useState(!1),d=$(),u=(r,i)=>{if(!t||!t.options)return;const f=[...t.options];f[r]={...f[r],text:i},n({...t,options:f})},o=r=>{if(!t||!t.options)return;const i=t?.options.map((f,C)=>({...f,isCorrect:C===r}));n({...t,options:i})},h=r=>{if(!t||!t.options)return;const i=[...t.options];i[r].isCorrect=!i[r].isCorrect,n({...t,options:i})},v=async()=>{try{g(!0),await s([t]),n({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),await d.invalidateQueries({queryKey:["questions"]})}catch(r){console.error(r)}finally{g(!1)}};return e.jsxs(j,{className:"space-y-4",children:[e.jsx(Q,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:r=>n({...t,question:r.target.value})}),e.jsx(Q,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:r=>n({...t,topic:r.target.value})}),e.jsx(Q,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:r=>n({...t,marks:parseFloat(r.target.value)})}),e.jsx(Q,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:r=>n({...t,negative:parseFloat(r.target.value)})}),e.jsxs(Q,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:r=>{const i=r.target.value,f=Array(4).fill({text:"",isCorrect:!1});n({...t,category:i,options:f,answer:""})},children:[e.jsx(I,{value:"MCQ",children:"MCQ"}),e.jsx(I,{value:"MSQ",children:"MSQ"}),e.jsx(I,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(Q,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:r=>n({...t,answer:r.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&e.jsxs(j,{children:[e.jsx(m,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options&&t.options.map((r,i)=>e.jsxs(j,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(be,{size:"small",checked:r.isCorrect,onChange:()=>o(i)}):e.jsx(ye,{size:"small",checked:r.isCorrect,onChange:()=>h(i)}),e.jsx(Q,{size:"small",fullWidth:!0,label:`Option ${i+1}`,value:r.text,onChange:f=>u(i,f.target.value)})]},i))]}),e.jsx(S,{variant:"contained",onClick:v,disabled:p,children:p?"Submitting...":"Add Question"})]})}function Ee({open:s,onClose:t,onSuccess:n,bankId:p}){const[g,d]=y.useState(null),[u,o]=y.useState([]),h=$(),{enqueueSnackbar:v}=fe(),{mutateAsync:r,isPending:i}=ge({mutationFn:async a=>{await J.post(`${L}/api/admin/add/questionbanks/questions/${p}/`,a,{withCredentials:!0})},onSuccess:()=>{v("Questions added successfully!",{variant:"success"}),h.invalidateQueries({queryKey:["questionBank",p]}),t(),n()},onError:a=>{v(a?.response?.data?.message||"Failed to add questions",{variant:"error"})}}),f=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),b=JSON.parse(c);o(b)}catch{d("Invalid JSON format")}},C=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.arrayBuffer(),b=Ne(c,{type:"array"}),A=b.Sheets[b.SheetNames[0]],X=k.sheet_to_json(A).map(Z=>{const{question:ee,category:te,marks:se,negative:re,topic:ae,answer:ne,option1:oe,correct1:T,option2:ie,correct2:U,option3:ce,correct3:W,option4:le,correct4:_}=Z,E={question:ee||"",category:te||"MCQ",marks:parseFloat(se)||1,negative:parseFloat(re)||0,topic:ae||""};return E.category==="Text"?{...E,answer:ne||"",options:[]}:{...E,options:[{text:oe||"",isCorrect:T===!0||T==="true"},{text:ie||"",isCorrect:U===!0||U==="true"},{text:ce||"",isCorrect:W===!0||W==="true"},{text:le||"",isCorrect:_===!0||_==="true"}]}});o(X)}catch{d("Invalid Excel format")}},x=async a=>{const l=a.target.files?.[0];if(l)try{const c=await l.text(),b=Qe(c);if(b.length===0){d("No valid AIKEN questions found");return}d(null),o(b)}catch(c){console.error(c),d("Invalid AIKEN format")}},N=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",options:[{text:"Berlin",isCorrect:!1},{text:"Madrid",isCorrect:!1},{text:"Paris",isCorrect:!0},{text:"Rome",isCorrect:!1}]}],l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.json",c.click()},w=()=>{const a=[{question:"What is the capital of France?",category:"MCQ",marks:1,negative:.25,topic:"Geography",option1:"Berlin",correct1:!1,option2:"Madrid",correct2:!1,option3:"Paris",correct3:!0,option4:"Rome",correct4:!1}],l=k.json_to_sheet(a),c=k.book_new();k.book_append_sheet(c,l,"Sample"),Pe(c,"sample_questions.xlsx")},P=()=>{const a=`What is the capital of France?
                    A. Berlin
                    B. Madrid
                    C. Paris
                    D. Rome
                    ANSWER: C`,l=new Blob([a],{type:"text/plain"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="sample_questions.txt",c.click()},M=async a=>{await r(a)};return e.jsx(me,{open:s,onClose:t,children:e.jsxs(j,{sx:{...Re,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(m,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsx(ve,{onClick:t,children:e.jsx(je,{})})]}),e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap",children:[e.jsxs(S,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:f})]}),e.jsx(S,{startIcon:e.jsx(O,{}),onClick:N,children:"Download Sample"}),e.jsxs(S,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:C})]}),e.jsx(S,{startIcon:e.jsx(O,{}),onClick:w,children:"Download Sample"}),e.jsxs(S,{variant:"outlined",component:"label",startIcon:e.jsx(F,{fontSize:"small"}),children:["Upload AIKEN (.txt)",e.jsx("input",{type:"file",accept:".txt",hidden:!0,onChange:x})]}),e.jsx(S,{startIcon:e.jsx(O,{}),onClick:P,children:"Download Sample"})]}),g&&e.jsx(m,{color:"error",variant:"body2",className:"mb-2",children:g}),e.jsx(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(Ae,{onSubmit:M}),u.length>0&&e.jsxs(j,{className:"mt-6",children:[e.jsxs(m,{variant:"subtitle1",className:"mb-2 font-semibold",children:["Preview Uploaded Questions (",u.length,")"]}),u.map((a,l)=>e.jsxs(H,{defaultExpanded:l===0,children:[e.jsx(G,{expandIcon:e.jsx(Y,{}),children:e.jsxs(m,{children:["Q",l+1,": ",a.question.slice(0,80),"..."]})}),e.jsxs(V,{children:[e.jsxs(m,{children:[e.jsx("strong",{children:"Topic:"})," ",a.topic]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Marks:"})," ",a.marks]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Negative:"})," ",a.negative]}),e.jsxs(m,{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),(a.category==="MCQ"||a.category==="MSQ")&&e.jsx(j,{className:"mt-2 space-y-1",children:a.options?.map((c,b)=>e.jsxs(m,{children:[c.isCorrect?"✅":"⬜️"," Option ",b+1,": ",c.text]},b))})]})]},l)),e.jsx(S,{className:"mt-4",variant:"contained",disabled:i,onClick:()=>M(u),children:i?"Submitting...":"Submit All Previewed Questions"})]}),i&&e.jsx(B,{className:"mt-4"})]})})}var z=new Map,R=new WeakMap,K=0,Ie;function qe(s){return s?(R.has(s)||(K+=1,R.set(s,K.toString())),R.get(s)):"0"}function Fe(s){return Object.keys(s).sort().filter(t=>s[t]!==void 0).map(t=>`${t}_${t==="root"?qe(s.root):s[t]}`).toString()}function Oe(s){const t=Fe(s);let n=z.get(t);if(!n){const p=new Map;let g;const d=new IntersectionObserver(u=>{u.forEach(o=>{var h;const v=o.isIntersecting&&g.some(r=>o.intersectionRatio>=r);s.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=v),(h=p.get(o.target))==null||h.forEach(r=>{r(v,o)})})},s);g=d.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),n={id:t,observer:d,elements:p},z.set(t,n)}return n}function Be(s,t,n={},p=Ie){if(typeof window.IntersectionObserver>"u"&&p!==void 0){const h=s.getBoundingClientRect();return t(p,{isIntersecting:p,target:s,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:h,intersectionRect:h,rootBounds:h}),()=>{}}const{id:g,observer:d,elements:u}=Oe(n),o=u.get(s)||[];return u.has(s)||u.set(s,o),o.push(t),d.observe(s),function(){o.splice(o.indexOf(t),1),o.length===0&&(u.delete(s),d.unobserve(s)),u.size===0&&(d.disconnect(),z.delete(g))}}function ze({threshold:s,delay:t,trackVisibility:n,rootMargin:p,root:g,triggerOnce:d,skip:u,initialInView:o,fallbackInView:h,onChange:v}={}){var r;const[i,f]=y.useState(null),C=y.useRef(v),x=y.useRef(o),[N,w]=y.useState({inView:!!o,entry:void 0});C.current=v,y.useEffect(()=>{if(x.current===void 0&&(x.current=o),u||!i)return;let l;return l=Be(i,(c,b)=>{const A=x.current;x.current=c,!(A===void 0&&!c)&&(w({inView:c,entry:b}),C.current&&C.current(c,b),b.isIntersecting&&d&&l&&(l(),l=void 0))},{root:g,rootMargin:p,threshold:s,trackVisibility:n,delay:t},h),()=>{l&&l()}},[Array.isArray(s)?s.toString():s,i,g,p,d,u,n,h,t]);const P=(r=N.entry)==null?void 0:r.target,M=y.useRef(void 0);!i&&P&&!d&&!u&&M.current!==P&&(M.current=P,w({inView:!!o,entry:void 0}),x.current=o);const a=[f,N.inView,N.entry];return a.ref=a[0],a.inView=a[1],a.entry=a[2],a}function Le(){const{slug:s}=Ce(),[t,n]=y.useState(!1),{ref:p,inView:g}=ze(),{data:d,fetchNextPage:u,hasNextPage:o,isFetchingNextPage:h,isLoading:v,isError:r,refetch:i}=ke({queryKey:["questionBank",s],queryFn:async({pageParam:x})=>(await J.get(`${L}/api/admin/get/questionbank/questions/${s}?page=${x}&limit=10`,{withCredentials:!0})).data,initialPageParam:1,getNextPageParam:x=>x.hasMore?x.page+1:void 0,enabled:!!s}),f=d?.pages?.[0]?.bankDetails,C=d?d.pages.flatMap(x=>x.questions):[];return g&&o&&!h&&u(),e.jsxs(j,{mx:"auto",px:2,py:4,children:[e.jsxs(q,{elevation:3,sx:{p:4,borderRadius:3,mb:5,display:"flex",flexDirection:"column",gap:2},children:[t&&e.jsx(Ee,{open:!0,onSuccess:()=>{n(!1),i()},onClose:()=>n(!1),bankId:s||""}),e.jsx(m,{variant:"h5",fontWeight:"bold",children:f?.name||"Question Bank"}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Category: ",f?.category||"N/A"]}),e.jsx(we,{direction:"row",spacing:2,mt:1,children:e.jsx(S,{variant:"contained",color:"primary",onClick:()=>n(!0),sx:{textTransform:"none",borderRadius:2},children:"Add Question"})})]}),v&&e.jsx(j,{textAlign:"center",py:4,children:e.jsx(B,{})}),r&&e.jsx(m,{color:"error",textAlign:"center",children:"Failed to load questions."}),e.jsx(j,{display:"flex",flexWrap:"wrap",gap:2,children:C.map((x,N)=>e.jsx(j,{flex:"1 1 calc(33.33% - 16px)",minWidth:"300px",children:e.jsxs(H,{sx:{borderRadius:2},children:[e.jsx(G,{expandIcon:e.jsx(Y,{}),children:e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(m,{fontWeight:600,flex:1,pr:1,children:x.question||x.title||"Untitled Question"}),e.jsx(Se,{label:x.category,color:"primary",variant:"outlined",size:"small"})]})}),e.jsx(V,{children:x.category==="MCQ"?e.jsx(j,{display:"flex",flexWrap:"wrap",gap:1,children:x.options?.map((w,P)=>e.jsx(j,{flex:"1 1 calc(50% - 8px)",children:e.jsxs(q,{elevation:1,sx:{p:1,bgcolor:w.isCorrect?"#dcfce7":"#f3f4f6",border:w.isCorrect?"1px solid #22c55e":"1px solid #d1d5db"},children:[String.fromCharCode(65+P),". ",w.text]})},w._id||P))}):e.jsxs(j,{mt:2,children:[e.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Answer:"}),e.jsx(q,{variant:"outlined",sx:{p:1},children:e.jsx(m,{children:x.answer||"Not Provided"})})]})})]})},x._id||N))}),e.jsx(j,{ref:p,display:"flex",justifyContent:"center",py:3,children:h&&e.jsx(B,{size:24})}),!o&&!v&&e.jsx(m,{textAlign:"center",mt:3,color:"text.secondary",children:"No more questions."})]})}export{Le as default};
