import{ag as L,at as O,r as a,y as q,j as e,P as _,a5 as Q,a6 as F,a7 as K,aj as H,ak as N,al as G,am as u,an as t,ao as J,G as x,I as p,au as f,av as U,aw as V,a8 as W,aq as M,J as X,K as Y,N as Z,O as ee,Q as se,R as S,ax as te,ay as ae,x as P,B as D}from"./index-DrrpgQNc.js";const ne=async({sectionId:n,page:j,limit:r,search:l})=>(await P.get(`${D}/api/campus/test/get/section/${n}`,{params:{page:j,limit:r,search:l},withCredentials:!0})).data,le=()=>{const{id:n}=L(),j=O(),[r,l]=a.useState(0),[i,b]=a.useState(10),[c,w]=a.useState(""),[g,v]=a.useState(c),[A,d]=a.useState(!1),[m,y]=a.useState(null),[o,h]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{const s=setTimeout(()=>{v(c),l(0)},400);return()=>clearTimeout(s)},[c]);const{data:T,isLoading:k}=q({queryKey:["tests",n,r,i,g],queryFn:()=>ne({sectionId:n,page:r+1,limit:i,search:g}),enabled:!!n,staleTime:1e3*60*5}),C=T?.tests??[],z=T?.totalTests??0,R=(s,I)=>l(I),$=s=>{b(parseInt(s.target.value,10)),l(0)},B=s=>{y(s),d(!0)},E=async()=>{if(m)try{await P.delete(`${D}/api/campus/test/delete/${m._id}`,{withCredentials:!0}),h({open:!0,message:"Test deleted successfully",severity:"success"}),j.invalidateQueries({queryKey:["tests",n,r,i,g]})}catch(s){console.error(s),h({open:!0,message:"Failed to delete test",severity:"error"})}finally{d(!1),y(null)}};return e.jsxs(_,{sx:{p:3,borderRadius:3,overflow:"hidden"},children:[e.jsx(Q,{size:"small",placeholder:"Search tests...",value:c,onChange:s=>w(s.target.value),sx:{mb:2,width:"100%",maxWidth:400},InputProps:{startAdornment:e.jsx(F,{position:"start",children:e.jsx(K,{})})}}),e.jsx(H,{children:e.jsxs(N,{children:[e.jsx(G,{children:e.jsxs(u,{children:[e.jsx(t,{children:"Title"}),e.jsx(t,{children:"Category"}),e.jsx(t,{children:"Duration"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Cost"}),e.jsx(t,{children:"Created At"}),e.jsx(t,{align:"center",children:"Actions"}),e.jsx(t,{align:"center",children:"Delete"})]})}),e.jsx(J,{children:k?e.jsx(u,{children:e.jsx(t,{colSpan:8,align:"center",children:"Loading..."})}):C.length===0?e.jsx(u,{children:e.jsx(t,{colSpan:8,align:"center",children:"No tests found."})}):C.map(s=>e.jsxs(u,{hover:!0,children:[e.jsx(t,{children:s.name}),e.jsx(t,{children:s.category}),e.jsxs(t,{children:[s.duration," min"]}),e.jsx(t,{children:s.creator?.name||"-"}),e.jsx(t,{children:s.costPerAttempt?e.jsx(x,{title:`Total: ${s.costPerAttempt} Ã— ${s.noOfSubmissions}`,arrow:!0,children:e.jsx("span",{children:s.costPerAttempt*(s.noOfSubmissions||0)})}):"-"}),e.jsx(t,{children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"}),e.jsxs(t,{align:"center",children:[e.jsx(x,{title:"Preview Test",children:e.jsx(p,{component:f,to:`preview/${s?.slug}`,color:"primary",size:"small",children:e.jsx(U,{fontSize:"small"})})}),e.jsx(x,{title:"Edit Test",children:e.jsx(p,{component:f,to:`edit/${s._id}`,color:"warning",size:"small",children:e.jsx(V,{fontSize:"small"})})})]}),e.jsx(t,{align:"center",children:e.jsx(x,{title:"Delete Test",children:e.jsx(p,{color:"error",size:"small",onClick:()=>B(s),children:e.jsx(W,{fontSize:"small"})})})})]},s._id))})]})}),e.jsx(M,{component:"div",count:z,page:r,onPageChange:R,rowsPerPage:i,onRowsPerPageChange:$,rowsPerPageOptions:[5,10,20,50]}),e.jsxs(X,{open:A,onClose:()=>d(!1),children:[e.jsx(Y,{children:"Confirm Deletion"}),e.jsx(Z,{children:e.jsxs(ee,{children:['Are you sure you want to delete test "',m?.name,'"? This action cannot be undone.']})}),e.jsxs(se,{children:[e.jsx(S,{onClick:()=>d(!1),color:"inherit",children:"Cancel"}),e.jsx(S,{onClick:E,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(te,{open:o.open,autoHideDuration:3e3,onClose:()=>h({...o,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ae,{onClose:()=>h({...o,open:!1}),severity:o.severity,sx:{width:"100%"},children:o.message})})]})};export{le as default};
