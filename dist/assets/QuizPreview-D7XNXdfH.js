import{Y as N,r as u,w as v,j as e,C as E,t as p,B as h}from"./index-BGDZTkRm.js";import{u as C}from"./useQuery-COKBSNSj.js";import{B as P}from"./Button-BS37WqGQ.js";import{C as S}from"./CloudDownload-DTBvdMxJ.js";const k=async({slug:r,id:a,page:t})=>(await p.get(`${h}/api/campus/quiz/submissions/${r}/${a}`,{params:{page:t},withCredentials:!0})).data,$=()=>{const{slug:r,id:a}=N(),[t,n]=u.useState(1),[d,l]=u.useState(!1),{enqueueSnackbar:c}=v(),{data:x,isLoading:y,isError:g,refetch:j}=C({queryKey:["quizPreview",r,a,t],queryFn:()=>k({slug:r,id:a,page:t}),enabled:!!r&&!!a,staleTime:1e3*60*5}),f=async()=>{if(!(!r||!a)){l(!0);try{const s=await p.get(`${h}/api/campus/quiz/sections/download/${r}/${a}`,{responseType:"blob",withCredentials:!0}),w=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(w),o=document.createElement("a");o.href=b,o.download=`quiz_submissions_${r}.xlsx`,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(b),c("Excel exported successfully!",{variant:"success"})}catch(s){console.error("Error downloading Excel:",s),c("Failed to export Excel",{variant:"error"})}finally{l(!1)}}};if(y)return e.jsx("div",{className:"text-center py-10",children:"Loading..."});if(g)return e.jsxs("div",{className:"text-center py-10 text-red-500",children:["Failed to fetch data.",e.jsx("button",{onClick:()=>j(),className:"ml-2 underline text-indigo-600",children:"Retry"})]});const m=x?.list??[],i=x?.totalPages??1;return e.jsxs("div",{className:"p-6 flex flex-col gap-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Quiz Submissions"}),e.jsx(P,{variant:"contained",color:"success",onClick:f,disabled:d,startIcon:d?e.jsx(E,{size:18,color:"inherit"}):e.jsx(S,{}),children:d?"Exporting...":"Download Excel"})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow-md",children:e.jsxs("table",{className:"w-full text-sm text-left border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Name"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Email"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Score"}),e.jsx("th",{className:"px-4 py-3 border-b border-b-gray-200",children:"Submitted At"})]})}),e.jsxs("tbody",{children:[m.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.name}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.email}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:s.score}),e.jsx("td",{className:"px-4 py-4 border-b border-b-gray-50",children:new Date(s.updatedAt).toLocaleString()})]},s._id)),m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-gray-500",children:"No submissions found."})})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Page ",t," of ",i]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>n(s=>Math.max(s-1,1)),disabled:t===1,className:"px-3 py-1 text-sm border rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Prev"}),e.jsx("button",{onClick:()=>n(s=>Math.min(s+1,i)),disabled:t===i,className:"px-3 py-1 text-sm border rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Next"})]})]})]})};export{$ as default};
