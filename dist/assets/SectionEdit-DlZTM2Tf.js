import{ab as me,ac as he,r as t,ad as xe,X as pe,ae as fe,w as L,j as e,M as B,S as k,a5 as b,af as w,R as T,z as D,x as P,B as Q,E as K,C as R,F as O,ag as V,h as ge,J as je,N as ve,I as q,ah as X,ai as be,aj as ye,P as Ce,ak as Se,al as we,am as H,an as N,ao as ke,ap as Ee,a8 as Me,aq as ze,a4 as Ne,ar as Te,as as Ie,y as De}from"./index-Cx2ScfVW.js";import{r as Ae,u as F,w as Pe}from"./xlsx-DSqvgYLF.js";import{g as Z}from"./userSelector-C6liUQHe.js";import{U as Qe}from"./UploadFile-BwtB5Kmx.js";import{D as We}from"./Download-MqRB0DGD.js";import{S as Re}from"./StudentsTable-CANxh8gw.js";function Le(d,i,s,a,m){const[r,h]=t.useState(()=>m&&s?s(d).matches:a?a(d).matches:i);return pe(()=>{if(!s)return;const c=s(d),l=()=>{h(c.matches)};return l(),c.addEventListener("change",l),()=>{c.removeEventListener("change",l)}},[d,s]),r}const Ue={...xe},ee=Ue.useSyncExternalStore;function Fe(d,i,s,a,m){const r=t.useCallback(()=>i,[i]),h=t.useMemo(()=>{if(m&&s)return()=>s(d).matches;if(a!==null){const{matches:o}=a(d);return()=>o}return r},[r,d,a,m,s]),[c,l]=t.useMemo(()=>{if(s===null)return[r,()=>()=>{}];const o=s(d);return[()=>o.matches,n=>(o.addEventListener("change",n),()=>{o.removeEventListener("change",n)})]},[r,s,d]);return ee(l,c,h)}function se(d={}){const{themeId:i}=d;return function(a,m={}){let r=me();r&&i&&(r=r[i]||r);const h=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:c=!1,matchMedia:l=h?window.matchMedia:null,ssrMatchMedia:x=null,noSsr:o=!1}=he({name:"MuiUseMediaQuery",props:m,theme:r});let n=typeof a=="function"?a(r):a;return n=n.replace(/^@media( ?)/m,""),n.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(ee!==void 0?Fe:Le)(n,c,l,x,o)}}se();const Be=se({themeId:fe}),_e=L(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),$e=L(e.jsx("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"})),He=L(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),Oe=L([e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-5.99 13c-.59 0-1.05-.47-1.05-1.05 0-.59.47-1.04 1.05-1.04.59 0 1.04.45 1.04 1.04-.01.58-.45 1.05-1.04 1.05m2.5-6.17c-.63.93-1.23 1.21-1.56 1.81-.13.24-.18.4-.18 1.18h-1.52c0-.41-.06-1.08.26-1.65.41-.73 1.18-1.16 1.63-1.8.48-.68.21-1.94-1.14-1.94-.88 0-1.32.67-1.5 1.23l-1.37-.57C11.51 5.96 12.52 5 13.99 5c1.23 0 2.08.56 2.51 1.26.37.61.58 1.73.01 2.57"},"1")]),qe=L(e.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"})),Ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Ge=({open:d,onClose:i,sectionId:s})=>{const[a,m]=t.useState(""),[r,h]=t.useState(0),[c,l]=t.useState(30),[x,o]=t.useState("Core"),[n,p]=t.useState("Medium"),[y,f]=t.useState(""),[I,C]=t.useState(!1),[E,M]=t.useState(!1),z=async()=>{if(!a.trim()){f("Quiz title is required"),C(!0);return}if(r<=0){f("Marks must be greater than 0"),C(!0);return}if(c<=0){f("Duration must be greater than 0"),C(!0);return}M(!0),f(""),C(!1);try{const v=await P.post(`${Q}/api/campus/create/quiz/${s}`,{title:a,marks:r,duration:c,category:x,difficulty:n,sectionId:s},{withCredentials:!0});v.data.success?(f("Quiz created successfully!"),C(!1),m(""),h(0),l(30),o("Core"),p("Medium")):(f(v.data.message||"Failed to create quiz"),C(!0))}catch(v){console.error(v),f(v?.response?.data?.message||"Internal Server Error"),C(!0)}finally{M(!1)}};return e.jsx(B,{open:d,onClose:i,children:e.jsx(k,{sx:Ve,children:e.jsxs(k,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Quiz Title",value:a,onChange:v=>m(v.target.value),fullWidth:!0}),e.jsxs(k,{display:"flex",gap:2,children:[e.jsx(b,{label:"Marks",type:"number",value:r,onChange:v=>h(Number(v.target.value)),fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",type:"number",value:c,onChange:v=>l(Number(v.target.value)),fullWidth:!0})]}),e.jsxs(k,{display:"flex",gap:2,children:[e.jsxs(b,{select:!0,label:"Category",value:x,onChange:v=>o(v.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Core",children:"Core"}),e.jsx(w,{value:"Aptitude",children:"Aptitude"}),e.jsx(w,{value:"Miscellaneous",children:"Misc"})]}),e.jsxs(b,{select:!0,label:"Difficulty",value:n,onChange:v=>p(v.target.value),fullWidth:!0,children:[e.jsx(w,{value:"Easy",children:"Easy"}),e.jsx(w,{value:"Medium",children:"Medium"}),e.jsx(w,{value:"Hard",children:"Hard"})]})]}),e.jsx(T,{sx:{backgroundColor:"#FF5C01",color:"#ffffff"},variant:"contained",color:"primary",onClick:z,disabled:E,children:E?"Creating...":"Create Quiz"}),y&&e.jsx(D,{textAlign:"center",color:I?"error":"success.main",children:y})]})})})},Je={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Ye={name:"",description:"",duration:30,visibility:"private",category:"Placements"},Ke=({open:d,onClose:i,sectionId:s})=>{const[a,m]=t.useState(Ye),[r,h]=t.useState(!1),{enqueueSnackbar:c}=K(),l=o=>{const{name:n,value:p}=o.target;m(y=>({...y,[n]:n==="duration"?Number(p):p}))},x=async()=>{if(!a.name.trim()){c("Test name is required",{variant:"error"});return}if(a.duration<=0){c("Duration must be greater than 0",{variant:"error"});return}h(!0);try{await P.post(`${Q}/api/campus/create/test/${s}`,a,{withCredentials:!0}),c("âœ… Test created successfully!",{variant:"success"}),i()}catch(o){console.error(o),c(o?.response?.data?.error||"Internal Server Error",{variant:"error"})}finally{h(!1)}};return e.jsx(B,{open:d,onClose:i,children:e.jsxs(k,{sx:Je,children:[e.jsx(D,{variant:"h6",fontWeight:"bold",mb:3,children:"Create New Test"}),e.jsxs(k,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(b,{label:"Test Name",name:"name",value:a.name,onChange:l,fullWidth:!0}),e.jsx(b,{label:"Description",name:"description",value:a.description,onChange:l,multiline:!0,rows:3,fullWidth:!0}),e.jsx(b,{label:"Duration (minutes)",name:"duration",type:"number",value:a.duration,onChange:l,fullWidth:!0}),e.jsxs(b,{select:!0,label:"Category",name:"category",value:a.category,onChange:l,fullWidth:!0,children:[e.jsx(w,{value:"Placements",children:"Placements"}),e.jsx(w,{value:"Gate",children:"Gate"})]}),e.jsx(T,{variant:"contained",color:"primary",onClick:x,disabled:r,sx:{backgroundColor:"#FF5C01",color:"#ffffff"},children:r?e.jsx(R,{size:20}):"Create Test"})]})]})})};function Xe({open:d,setOpen:i}){const[s,a]=t.useState([]),[m,r]=t.useState(null);console.log(m);const[h,c]=t.useState(!1),[l,x]=t.useState(null),[o,n]=t.useState(0),[p,y]=t.useState(5),[f,I]=t.useState(""),[C,E]=t.useState(!1),z=O(u=>u.auth.user)?.user._id,{id:v}=V(),te=O(Z),ae=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,{enqueueSnackbar:_}=K(),ne=ge(),G=Be(ne.breakpoints.down("sm")),re=async u=>{if(u.preventDefault(),s.length===0){x("Please add at least one valid email");return}if(s.filter(g=>g.role==="campus-admin").length>5){x("You can only invite up to 5 campus-admins at a time.");return}E(!0),_("Processing invites...",{variant:"info"});try{const g=s.map(W=>({email:W.email,name:W.name||"Unknown",role:W.role,groupId:te,sectionId:v,invitedBy:z})),A=await P.post(`${Q}/api/campus/section/add`,{invites:g},{withCredentials:!0});r(A.data),a([]),x(null),_("Invite send successfully",{variant:"success"}),i(!1)}catch(g){r({error:g.response?.data||g.message}),_("Error sending",{variant:"success"})}finally{E(!1)}},le=()=>{a(u=>[...u,{email:"",name:"",role:"user"}])},oe=u=>{const j=u.target.files?.[0];if(!j)return;c(!0);const g=new FileReader;g.onload=A=>{const W=new Uint8Array(A.target?.result),J=Ae(W,{type:"array"}),de=J.Sheets[J.SheetNames[0]],Y=F.sheet_to_json(de).map(S=>({email:S.Email?.trim(),name:S.Name?.trim()||"Unknown",role:S.Role&&["user","campus-admin"].includes(S.Role)?S.Role:"user"})).filter(S=>S.email&&ae.test(S.email)&&!s.some(ue=>ue.email===S.email));Y.length===0?x("No valid users found in file"):(a(S=>[...S,...Y]),x(null)),c(!1)},g.readAsArrayBuffer(j)},ie=()=>{const u=[{Name:"John Doe",Email:"user1@example.com",Role:"user"},{Name:"Jane Smith",Email:"user2@example.com",Role:"campus-admin"}],j=F.json_to_sheet(u),g=F.book_new();F.book_append_sheet(g,j,"Users"),Pe(g,"sample_users.xlsx")},$=(u,j,g)=>{const A=[...s];A[u][j]=g,a(A)},ce=u=>{const j=[...s];j.splice(u,1),a(j)},U=t.useMemo(()=>f?s.filter(u=>u.email.toLowerCase().includes(f.toLowerCase())||u.name.toLowerCase().includes(f.toLowerCase())):s,[f,s]);return e.jsx(e.Fragment,{children:e.jsx(je,{maxWidth:"xl",fullWidth:!0,open:d,onClose:()=>i(!1),fullScreen:G,PaperProps:{sx:{p:3,height:G?"100%":"90vh"}},children:e.jsxs(ve,{className:"flex flex-col gap-3",sx:{overflowY:"auto"},children:[e.jsx(D,{variant:"h5",mb:2,align:"center",children:"Add Members"}),e.jsx(q,{onClick:()=>i(!1),sx:{position:"absolute",right:5,top:3},children:e.jsx(X,{})}),e.jsx(b,{size:"small",fullWidth:!0,placeholder:"Search by name or email",value:f,onChange:u=>I(u.target.value),sx:{mb:2}}),e.jsxs("form",{onSubmit:re,className:"flex flex-col gap-3",children:[l&&e.jsx(be,{error:!0,children:l}),e.jsxs(k,{display:"flex",gap:1,children:[e.jsxs(T,{variant:"outlined",size:"small",startIcon:e.jsx(Qe,{}),component:"label",disabled:h,children:[h?e.jsx(R,{size:18}):"Upload",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.csv",onChange:oe})]}),e.jsx(T,{variant:"outlined",size:"small",startIcon:e.jsx(We,{}),onClick:ie,children:"Sample"}),e.jsx(T,{variant:"outlined",size:"small",onClick:le,children:"Add +"})]}),e.jsxs(ye,{component:Ce,sx:{mt:2},children:[e.jsxs(Se,{size:"small",children:[e.jsx(we,{children:e.jsxs(H,{children:[e.jsx(N,{children:"Email"}),e.jsx(N,{children:"Name"}),e.jsx(N,{children:"Role"}),e.jsx(N,{children:"Action"})]})}),e.jsx(ke,{children:U.length>0?U.slice(o*p,o*p+p).map((u,j)=>e.jsxs(H,{children:[e.jsx(N,{children:e.jsx(b,{fullWidth:!0,size:"small",value:u.email,onChange:g=>$(o*p+j,"email",g.target.value)})}),e.jsx(N,{children:e.jsx(b,{size:"small",fullWidth:!0,value:u.name,onChange:g=>$(o*p+j,"name",g.target.value)})}),e.jsx(N,{children:e.jsxs(Ee,{fullWidth:!0,size:"small",value:u.role,onChange:g=>$(o*p+j,"role",g.target.value),children:[e.jsx(w,{value:"user",children:"User"}),e.jsx(w,{value:"campus-admin",children:"Campus Admin"})]})}),e.jsx(N,{children:e.jsx(q,{color:"error",onClick:()=>ce(o*p+j),children:e.jsx(Me,{})})})]},j)):e.jsx(H,{children:e.jsx(N,{colSpan:4,align:"center",children:"No users added yet"})})})]}),U.length>0&&e.jsx(ze,{component:"div",count:U.length,page:o,onPageChange:(u,j)=>n(j),rowsPerPage:p,onRowsPerPageChange:u=>{y(parseInt(u.target.value,10)),n(0)}})]}),e.jsx(T,{type:"submit",variant:"contained",fullWidth:!0,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:18,sx:{mr:1}}),"Processing..."]}):"Send Invites"})]})]})})})}const Ze=({sectionId:d,open:i,onClose:s,onSuccess:a})=>{const[m,r]=t.useState({name:"",sectionId:d,visibility:"public"}),[h,c]=t.useState(!1),[l,x]=t.useState(null),[o,n]=t.useState(null),p=f=>{r({...m,[f.target.name]:f.target.value})},y=async f=>{f.preventDefault(),c(!0),x(null),n(null);try{(await P.post(`${Q}/api/exam/create`,m)).data.success&&(n("Exam created successfully!"),a?.(),r({name:"",sectionId:d,visibility:"public"}),setTimeout(()=>{n(null),s()},1e3))}catch(I){x(I.response?.data?.message||"Error creating exam")}finally{c(!1)}};return e.jsx(B,{open:i,onClose:s,closeAfterTransition:!0,slots:{backdrop:Ne},slotProps:{backdrop:{timeout:300}},children:e.jsx(Te,{in:i,children:e.jsxs(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:3,boxShadow:24,p:4,width:"90%",maxWidth:450},children:[e.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(D,{variant:"h6",fontWeight:"bold",children:"Create New Exam"}),e.jsx(q,{onClick:s,size:"small",children:e.jsx(X,{})})]}),e.jsxs(k,{component:"form",onSubmit:y,sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(b,{label:"Exam Name",name:"name",value:m.name,onChange:p,required:!0,fullWidth:!0}),l&&e.jsx(D,{color:"error",variant:"body2",children:l}),o&&e.jsx(D,{color:"success.main",variant:"body2",children:o}),e.jsx(T,{type:"submit",variant:"contained",disabled:h,fullWidth:!0,sx:{mt:1},children:h?e.jsx(R,{size:24}):"Create Exam"})]})]})})})},es=["Core","Aptitude","Excel","Miscellaneous"],ss=({open:d,onClose:i,onSuccess:s})=>{const{id:a}=V(),[m,r]=t.useState(""),[h,c]=t.useState(""),[l,x]=t.useState(!1),o=async()=>{if(!m||!h){alert("Please fill in all fields");return}try{x(!0),await P.post(`${Q}/api/exam/create/bank`,{name:m,category:h,sectionId:a}),r(""),c(""),s&&s(),i()}catch(n){console.error(n),alert(n.response?.data?.message||"Failed to create bank")}finally{x(!1)}};return e.jsx(B,{open:d,onClose:i,children:e.jsxs(k,{sx:{backgroundColor:"background.paper",borderRadius:3,boxShadow:5,p:4,width:400,mx:"auto",mt:"15vh",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(D,{variant:"h6",fontWeight:"600",textAlign:"center",children:"Create Question Bank"}),e.jsx(b,{label:"Bank Name",variant:"outlined",fullWidth:!0,value:m,onChange:n=>r(n.target.value)}),e.jsx(b,{select:!0,label:"Category",value:h,onChange:n=>c(n.target.value),fullWidth:!0,children:es.map(n=>e.jsx(w,{value:n,children:n},n))}),e.jsxs(Ie,{direction:"row",justifyContent:"flex-end",spacing:2,mt:2,children:[e.jsx(T,{onClick:i,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(T,{onClick:o,variant:"contained",color:"primary",disabled:l,children:l?e.jsx(R,{size:22,color:"inherit"}):"Create"})]})]})})},ts=async({sectionId:d,groupId:i})=>i?(await P.get(`${Q}/api/campus/insights/${d}/${i}`,{withCredentials:!0})).data:null,ds=()=>{const[d,i]=t.useState(!1),[s,a]=t.useState(!1),[m,r]=t.useState(!1),[h,c]=t.useState(!1),{id:l}=V(),x=O(Z)??"",[o,n]=t.useState(!1),{data:p,isLoading:y,isError:f,refetch:I}=De({queryKey:["sectionInsights",l,x],queryFn:()=>ts({sectionId:l,groupId:x}),enabled:!!l&&!!x,staleTime:1e3*60*5}),C=[{label:"Total Users",value:p?.totalUsers??0,icon:e.jsx(He,{className:"text-orange-600"})},{label:"Total Quizzes",value:p?.totalQuizzes??0,icon:e.jsx(Oe,{className:"text-orange-600"})},{label:"Quiz Submissions",value:p?.totalQuizSubmissions??0,icon:e.jsx(_e,{className:"text-orange-600"})},{label:"Total Tests",value:p?.totalTests??0,icon:e.jsx(qe,{className:"text-orange-600"})},{label:"Test Submissions",value:p?.totalTestSubmissions??0,icon:e.jsx($e,{className:"text-orange-600"})}],E=({onClick:M,label:z})=>e.jsxs("button",{onClick:M,className:"flex cursor-pointer items-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium shadow-md hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200",children:[e.jsx("span",{children:z}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]});return e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx(Xe,{open:o,setOpen:()=>n(!1)}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(E,{label:"Add Quiz",onClick:()=>i(!0)}),e.jsx(E,{label:"Add Exam",onClick:()=>r(!0)}),e.jsx(E,{label:"Add Bank",onClick:()=>c(!0)}),e.jsx("div",{className:"relative group",children:e.jsx(E,{label:"Add Members",onClick:()=>n(!0)})})]}),y&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((M,z)=>e.jsx("div",{className:"h-24 bg-gray-200 animate-pulse rounded-2xl"},z))}),f&&e.jsxs("div",{className:"text-red-600 bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium",children:"Failed to fetch insights."}),e.jsx("button",{onClick:()=>I(),className:"underline text-sm hover:text-red-800",children:"Retry"})]}),!y&&!f&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:C.map((M,z)=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-md hover:shadow-lg transition-all duration-200 p-5 flex flex-col items-center text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full mb-3",children:M.icon}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:M.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:M.value})]},z))}),e.jsx(Ge,{open:d,onClose:()=>i(!1),sectionId:l}),e.jsx(Ke,{open:s,onClose:()=>a(!1),sectionId:l}),e.jsx(ss,{open:h,onClose:()=>c(!1)}),e.jsx(Ze,{sectionId:l,open:m,onClose:()=>r(!1)}),e.jsx(Re,{})]})};export{ds as default};
