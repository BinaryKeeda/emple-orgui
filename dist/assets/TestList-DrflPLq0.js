import{Y as L,Z as _,r as n,j as e,y as m,I as g,_ as C,t as D,B as b}from"./index-DIURjhAd.js";import{u as O}from"./useQuery-DKyb2Rjj.js";import{P as q}from"./Modal-aMNQSBK5.js";import{T as F}from"./TextField-CLyTsw8R.js";import{I as Q,S as H}from"./Search-CJgmTVSw.js";import{T as K,a as V,b as N,c as u,d as t,e as U}from"./TableRow-BsXJunwG.js";import{V as W,E as Y,S as Z,A as G}from"./Visibility-BFvsA6Dx.js";import{D as J}from"./Delete-CQw06rrR.js";import{T as M}from"./TablePagination-D695FMyu.js";import{D as X,a as ee,b as se,c as te,d as ne}from"./DialogTitle-DsJKiJmL.js";import{B as S}from"./Button-BXEi_mMv.js";import"./Typography-BrV-ZvW1.js";import"./MenuItem-CGARwiIG.js";import"./dividerClasses-CkepYj8H.js";const re=async({sectionId:r,page:x,limit:a,search:o})=>(await D.get(`${b}/api/campus/test/get/section/${r}`,{params:{page:x,limit:a,search:o},withCredentials:!0})).data,Te=()=>{const{id:r}=L(),x=_(),[a,o]=n.useState(0),[i,P]=n.useState(10),[c,w]=n.useState(""),[p,v]=n.useState(c),[A,d]=n.useState(!1),[j,f]=n.useState(null),[l,h]=n.useState({open:!1,message:"",severity:"success"});n.useEffect(()=>{const s=setTimeout(()=>{v(c),o(0)},400);return()=>clearTimeout(s)},[c]);const{data:T,isLoading:z}=O({queryKey:["tests",r,a,i,p],queryFn:()=>re({sectionId:r,page:a+1,limit:i,search:p}),enabled:!!r,staleTime:1e3*60*5}),y=T?.tests??[],$=T?.totalTests??0,k=(s,R)=>o(R),B=s=>{P(parseInt(s.target.value,10)),o(0)},E=s=>{f(s),d(!0)},I=async()=>{if(j)try{await D.delete(`${b}/api/campus/test/delete/${j._id}`,{withCredentials:!0}),h({open:!0,message:"Test deleted successfully",severity:"success"}),x.invalidateQueries({queryKey:["tests",r,a,i,p]})}catch(s){console.error(s),h({open:!0,message:"Failed to delete test",severity:"error"})}finally{d(!1),f(null)}};return e.jsxs(q,{sx:{p:3,borderRadius:3,overflow:"hidden"},children:[e.jsx(F,{size:"small",placeholder:"Search tests...",value:c,onChange:s=>w(s.target.value),sx:{mb:2,width:"100%",maxWidth:400},InputProps:{startAdornment:e.jsx(Q,{position:"start",children:e.jsx(H,{})})}}),e.jsx(K,{children:e.jsxs(V,{children:[e.jsx(N,{children:e.jsxs(u,{children:[e.jsx(t,{children:"Title"}),e.jsx(t,{children:"Category"}),e.jsx(t,{children:"Duration"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Cost"}),e.jsx(t,{children:"Created At"}),e.jsx(t,{align:"center",children:"Actions"}),e.jsx(t,{align:"center",children:"Delete"})]})}),e.jsx(U,{children:z?e.jsx(u,{children:e.jsx(t,{colSpan:8,align:"center",children:"Loading..."})}):y.length===0?e.jsx(u,{children:e.jsx(t,{colSpan:8,align:"center",children:"No tests found."})}):y.map(s=>e.jsxs(u,{hover:!0,children:[e.jsx(t,{children:s.name}),e.jsx(t,{children:s.category}),e.jsxs(t,{children:[s.duration," min"]}),e.jsx(t,{children:s.creator?.name||"-"}),e.jsx(t,{children:s.costPerAttempt?e.jsx(m,{title:`Total: ${s.costPerAttempt} Ã— ${s.noOfSubmissions}`,arrow:!0,children:e.jsx("span",{children:s.costPerAttempt*(s.noOfSubmissions||0)})}):"-"}),e.jsx(t,{children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"}),e.jsxs(t,{align:"center",children:[e.jsx(m,{title:"Preview Test",children:e.jsx(g,{component:C,to:`preview/${s?.slug}`,color:"primary",size:"small",children:e.jsx(W,{fontSize:"small"})})}),e.jsx(m,{title:"Edit Test",children:e.jsx(g,{component:C,to:`edit/${s._id}`,color:"warning",size:"small",children:e.jsx(Y,{fontSize:"small"})})})]}),e.jsx(t,{align:"center",children:e.jsx(m,{title:"Delete Test",children:e.jsx(g,{color:"error",size:"small",onClick:()=>E(s),children:e.jsx(J,{fontSize:"small"})})})})]},s._id))})]})}),e.jsx(M,{component:"div",count:$,page:a,onPageChange:k,rowsPerPage:i,onRowsPerPageChange:B,rowsPerPageOptions:[5,10,20,50]}),e.jsxs(X,{open:A,onClose:()=>d(!1),children:[e.jsx(ee,{children:"Confirm Deletion"}),e.jsx(se,{children:e.jsxs(te,{children:['Are you sure you want to delete test "',j?.name,'"? This action cannot be undone.']})}),e.jsxs(ne,{children:[e.jsx(S,{onClick:()=>d(!1),color:"inherit",children:"Cancel"}),e.jsx(S,{onClick:I,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(Z,{open:l.open,autoHideDuration:3e3,onClose:()=>h({...l,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(G,{onClose:()=>h({...l,open:!1}),severity:l.severity,sx:{width:"100%"},children:l.message})})]})};export{Te as default};
